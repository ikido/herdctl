{"id":"herdctl-001","title":"Config Parsing Foundation","description":"Implement the configuration parsing foundation for herdctl in packages/core/src/config/. This module parses and validates fleet configuration (herdctl.yaml) and individual agent YAML files, providing a type-safe, validated configuration object for the rest of the system.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-19T16:32:24.448999-05:00","updated_at":"2026-01-19T16:34:57.975682-05:00","labels":["feature","ralph"],"deleted_at":"2026-01-19T16:34:57.975682-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"herdctl-002","title":"US-1: Parse Fleet Configuration","description":"As a fleet operator, I want to load a herdctl.yaml file so that I can define my fleet's default settings and agent references.\n\n## Acceptance Criteria\n- [ ] Parses valid herdctl.yaml files using the yaml package\n- [ ] Returns typed FleetConfig object validated by Zod\n- [ ] Throws descriptive errors for invalid YAML syntax\n- [ ] Throws descriptive errors for schema validation failures\n- [ ] Supports all fields from SPEC.md: fleet, defaults, agents, workspace, chat, webhooks, docker\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with tests for this functionality","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-19T16:32:24.448999-05:00","updated_at":"2026-01-19T16:34:57.975682-05:00","labels":["ralph","task"],"deleted_at":"2026-01-19T16:34:57.975682-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"herdctl-003","title":"US-2: Parse Agent Configuration","description":"As a fleet operator, I want to define agents in separate YAML files so that I can organize my agent configurations modularly.\n\n## Acceptance Criteria\n- [ ] Parses agent YAML files referenced by path in fleet config\n- [ ] Returns typed AgentConfig object validated by Zod\n- [ ] Supports all agent fields: name, description, workspace, repo, identity, work_source, schedules, session, permissions, mcp_servers, chat\n- [ ] Handles relative paths resolved from fleet config location\n- [ ] Throws descriptive errors with file path context\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with tests for this functionality","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-19T16:32:24.448999-05:00","updated_at":"2026-01-19T16:34:57.975682-05:00","labels":["ralph","task"],"deleted_at":"2026-01-19T16:34:57.975682-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"herdctl-004","title":"US-3: Merge Defaults with Agent Overrides","description":"As a fleet operator, I want to define fleet-level defaults that agents can override so that I don't repeat common configuration across agents.\n\n## Acceptance Criteria\n- [ ] Fleet defaults section merges into each agent config\n- [ ] Agent-specific values override fleet defaults (deep merge)\n- [ ] Merge applies to: permissions, work_source, session, docker, model, max_turns, permission_mode\n- [ ] Nested objects merge recursively (e.g., permissions.allowed_tools)\n- [ ] Arrays are replaced, not merged (agent's allowed_tools replaces defaults)\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with tests for this functionality","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-19T16:32:24.448999-05:00","updated_at":"2026-01-19T16:34:57.975682-05:00","labels":["ralph","task"],"deleted_at":"2026-01-19T16:34:57.975682-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"herdctl-005","title":"US-4: Environment Variable Interpolation","description":"As a fleet operator, I want to use ${VAR} syntax in YAML values so that I can inject secrets and environment-specific values.\n\n## Acceptance Criteria\n- [ ] Interpolates ${VAR_NAME} patterns in string values\n- [ ] Supports ${VAR:-default} syntax for default values\n- [ ] Throws error for undefined variables without defaults\n- [ ] Preserves non-string values (numbers, booleans, objects)\n- [ ] Works at any nesting depth in the config\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with tests for this functionality","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-19T16:32:24.448999-05:00","updated_at":"2026-01-19T16:34:57.975682-05:00","labels":["ralph","task"],"deleted_at":"2026-01-19T16:34:57.975682-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"herdctl-006","title":"US-5: Load Complete Configuration","description":"As a developer using @herdctl/core, I want to call a single function to load all config so that I get a fully resolved, validated configuration object.\n\n## Acceptance Criteria\n- [ ] loadConfig(configPath?: string) function auto-discovers herdctl.yaml\n- [ ] Searches current directory and parents (like git does)\n- [ ] Loads fleet config, all referenced agents, merges defaults\n- [ ] Returns ResolvedConfig with all agents fully resolved\n- [ ] Validates entire config tree before returning\n- [ ] Can load examples/simple/herdctl.yaml and resolve all agents\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of config module","status":"tombstone","priority":3,"issue_type":"task","created_at":"2026-01-19T16:32:24.448999-05:00","updated_at":"2026-01-19T16:34:57.975682-05:00","labels":["ralph","task"],"deleted_at":"2026-01-19T16:34:57.975682-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"herdctl-08c","title":"Config Parsing Foundation","description":"Implement the configuration parsing foundation for herdctl in packages/core/src/config/. This module parses and validates fleet configuration (herdctl.yaml) and individual agent YAML files, providing a type-safe, validated configuration object for the rest of the system.","status":"closed","priority":0,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-19T16:35:05.79657-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T17:15:23.987874-05:00","closed_at":"2026-01-19T17:15:23.987874-05:00","close_reason":"Closed","external_ref":"prd:./tasks/config-parsing-prd.md","labels":["feature","ralph"]}
{"id":"herdctl-08c.1","title":"US-1: Parse Fleet Configuration","description":"As a fleet operator, I want to load a herdctl.yaml file so that I can define my fleet's default settings and agent references.\n\n## Acceptance Criteria\n- [ ] Parses valid herdctl.yaml files using the yaml package\n- [ ] Returns typed FleetConfig object validated by Zod\n- [ ] Throws descriptive errors for invalid YAML syntax\n- [ ] Throws descriptive errors for schema validation failures\n- [ ] Supports all fields from SPEC.md: fleet, defaults, agents, workspace, chat, webhooks, docker\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of config module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T16:35:24.07093-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T16:45:38.811398-05:00","closed_at":"2026-01-19T16:45:38.811398-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08c.1","depends_on_id":"herdctl-08c","type":"parent-child","created_at":"2026-01-19T16:35:24.071451-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08c.2","title":"US-2: Parse Agent Configuration","description":"As a fleet operator, I want to define agents in separate YAML files so that I can organize my agent configurations modularly.\n\n## Acceptance Criteria\n- [ ] Parses agent YAML files referenced by path in fleet config\n- [ ] Returns typed AgentConfig object validated by Zod\n- [ ] Supports all agent fields: name, description, workspace, repo, identity, work_source, schedules, session, permissions, mcp_servers, chat\n- [ ] Handles relative paths resolved from fleet config location\n- [ ] Throws descriptive errors with file path context\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of config module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T16:35:32.594497-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T16:49:48.666339-05:00","closed_at":"2026-01-19T16:49:48.666339-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08c.2","depends_on_id":"herdctl-08c","type":"parent-child","created_at":"2026-01-19T16:35:32.594991-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08c.2","depends_on_id":"herdctl-08c.1","type":"blocks","created_at":"2026-01-19T16:36:07.490289-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08c.3","title":"US-3: Merge Defaults with Agent Overrides","description":"As a fleet operator, I want to define fleet-level defaults that agents can override so that I don't repeat common configuration across agents.\n\n## Acceptance Criteria\n- [ ] Fleet defaults section merges into each agent config\n- [ ] Agent-specific values override fleet defaults (deep merge)\n- [ ] Merge applies to: permissions, work_source, session, docker, model, max_turns, permission_mode\n- [ ] Nested objects merge recursively (e.g., permissions.allowed_tools)\n- [ ] Arrays are replaced, not merged (agent's allowed_tools replaces defaults)\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of config module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T16:35:40.858149-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T16:55:12.359393-05:00","closed_at":"2026-01-19T16:55:12.359393-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08c.3","depends_on_id":"herdctl-08c","type":"parent-child","created_at":"2026-01-19T16:35:40.858665-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08c.3","depends_on_id":"herdctl-08c.1","type":"blocks","created_at":"2026-01-19T16:36:09.87234-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08c.3","depends_on_id":"herdctl-08c.2","type":"blocks","created_at":"2026-01-19T16:36:09.932272-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08c.4","title":"US-4: Environment Variable Interpolation","description":"As a fleet operator, I want to use ${VAR} syntax in YAML values so that I can inject secrets and environment-specific values.\n\n## Acceptance Criteria\n- [ ] Interpolates ${VAR_NAME} patterns in string values\n- [ ] Supports ${VAR:-default} syntax for default values\n- [ ] Throws error for undefined variables without defaults\n- [ ] Preserves non-string values (numbers, booleans, objects)\n- [ ] Works at any nesting depth in the config\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of config module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T16:35:47.087373-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T16:58:00.83921-05:00","closed_at":"2026-01-19T16:58:00.83921-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08c.4","depends_on_id":"herdctl-08c","type":"parent-child","created_at":"2026-01-19T16:35:47.08787-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08c.4","depends_on_id":"herdctl-08c.1","type":"blocks","created_at":"2026-01-19T16:36:11.301987-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08c.5","title":"US-5: Load Complete Configuration","description":"As a developer using @herdctl/core, I want to call a single function to load all config so that I get a fully resolved, validated configuration object.\n\n## Acceptance Criteria\n- [ ] loadConfig(configPath?: string) function auto-discovers herdctl.yaml\n- [ ] Searches current directory and parents (like git does)\n- [ ] Loads fleet config, all referenced agents, merges defaults\n- [ ] Returns ResolvedConfig with all agents fully resolved\n- [ ] Validates entire config tree before returning\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of config module","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T16:35:53.473938-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T17:03:13.886438-05:00","closed_at":"2026-01-19T17:03:13.886438-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08c.5","depends_on_id":"herdctl-08c","type":"parent-child","created_at":"2026-01-19T16:35:53.4744-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08c.5","depends_on_id":"herdctl-08c.3","type":"blocks","created_at":"2026-01-19T16:36:12.905191-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08c.5","depends_on_id":"herdctl-08c.4","type":"blocks","created_at":"2026-01-19T16:36:12.965556-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m","title":"@herdctl/discord - Per-Agent Discord Bot Connector","description":"Discord connector package for herdctl enabling each agent to have its own Discord bot presence. Each chat-enabled agent connects to Discord as an independent bot with its own identity, avatar, and presence.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-20T17:54:20.747941-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:04:10.747651-05:00","closed_at":"2026-01-26T22:04:10.747651-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-herdctldiscord-per-agent-discord-bot-connector.md","labels":["feature","ralph"]}
{"id":"herdctl-08m.1","title":"US-2: Agent Chat Configuration Schema","description":"As a developer configuring agents, I want to specify Discord settings per-agent so that each agent has its own bot identity.\n\n## Acceptance Criteria\n- [ ] Add AgentChatDiscordSchema to core config validation (packages/core/src/config/)\n- [ ] Bot token comes from environment variable (never in config file)\n- [ ] Guilds/channels define where this bot participates\n- [ ] Mode determines response behavior (mention vs auto)\n- [ ] Session expiry is configurable per-agent (default 24 hours)\n- [ ] Bot presence/status is configurable per-agent\n- [ ] Log level is configurable per-agent\n- [ ] Include all Zod schemas: DiscordPresenceSchema, DiscordDMSchema, DiscordChannelSchema, DiscordGuildSchema, AgentChatDiscordSchema, AgentChatSchema\n- [ ] Export types from package entry points\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:54:29.281552-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:02:13.670812-05:00","closed_at":"2026-01-20T18:02:13.670812-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.1","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:54:29.282268-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.10","title":"US-10: Logging \u0026 Observability","description":"As a developer operating herdctl, I want configurable logging for Discord connectors so that I can debug issues without excessive noise.\n\n## Log Levels\n- minimal - Only errors and critical state changes\n- standard - Connection events, message counts, session operations (default)\n- verbose - All messages logged with content redaction option\n\n## Acceptance Criteria\n- [ ] Log level configurable per-agent in config\n- [ ] Standard level logs: connect/disconnect, message received/sent counts, session create/resume/expire\n- [ ] Emit events for FleetManager to consume (rate limits, errors, connection state)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:45.848757-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:57:42.341901-05:00","closed_at":"2026-01-20T18:57:42.341901-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.10","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:45.849322-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.10","depends_on_id":"herdctl-08m.9","type":"blocks","created_at":"2026-01-20T17:55:48.587719-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.11","title":"US-11: Documentation","description":"As a user setting up Discord integration, I want clear documentation so that I can configure everything correctly.\n\n## Documentation Location\ndocs/src/content/docs/integrations/discord.mdx\n\n## Sections\n1. Overview - Per-agent bot architecture explanation\n2. Prerequisites - Discord account, server admin permissions\n3. Creating a Discord Application - Step-by-step Developer Portal guide\n4. Bot Permissions \u0026 Intents - Required intents and permissions\n5. Inviting the Bot - OAuth2 URL generation\n6. Agent Configuration - Config file setup with examples\n7. Environment Variables - Token naming convention\n8. Getting Discord IDs - Developer Mode instructions\n9. Testing the Integration - Verification steps\n10. Multiple Agents in Same Server - Setup guidance\n11. Troubleshooting - Common errors and solutions\n\n## Acceptance Criteria\n- [ ] Documentation is complete for all sections\n- [ ] Includes screenshots or diagrams where helpful\n- [ ] Documentation builds successfully with pnpm build in docs/\n- [ ] Tested with a real Discord server setup\n- [ ] pnpm typecheck passes\n- [ ] pnpm build succeeds","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:56.654438-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:01:11.212186-05:00","closed_at":"2026-01-20T19:01:11.212186-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.11","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:56.654982-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.11","depends_on_id":"herdctl-08m.10","type":"blocks","created_at":"2026-01-20T17:55:59.302108-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.2","title":"US-1: Discord Connector Class","description":"As a developer using herdctl, I want a DiscordConnector class that connects an agent to Discord so that each agent can have its own Discord bot presence.\n\n## Acceptance Criteria\n- [ ] Create packages/discord/ directory with package.json, tsconfig.json\n- [ ] DiscordConnector class accepts agent config, bot token, and FleetManager reference\n- [ ] Uses discord.js v14 to connect to Discord gateway\n- [ ] Handles connection events (ready, disconnect, error, reconnect)\n- [ ] Auto-reconnects with exponential backoff on connection loss (discord.js default)\n- [ ] Graceful shutdown on stop signal\n- [ ] One instance per agent (not shared)\n- [ ] Implements interface: connect(), disconnect(), isConnected()\n- [ ] Unit tests for connection/disconnection lifecycle\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:54:35.927005-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:11:10.44788-05:00","closed_at":"2026-01-20T18:11:10.44788-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.2","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:54:35.927634-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.2","depends_on_id":"herdctl-08m.1","type":"blocks","created_at":"2026-01-20T17:54:38.84636-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.3","title":"US-5: Per-Channel Session Management","description":"As a user chatting with an agent, I want my conversation context preserved so that the agent remembers what we discussed.\n\n## Acceptance Criteria\n- [ ] SessionManager class created per-agent (not shared)\n- [ ] Store session ID per channel/DM\n- [ ] Resume existing session when user sends message\n- [ ] Persist session mappings to .herdctl/discord-sessions/\u003cagent-name\u003e.yaml\n- [ ] Sessions expire based on configurable timeout (default 24 hours of inactivity)\n- [ ] Cleanup expired sessions on connector startup\n- [ ] Handle session expiry gracefully (create new if expired)\n- [ ] State structure follows YAML format with sessionId and lastMessageAt\n- [ ] Unit tests for create/resume/expire/cleanup operations\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:54:45.452967-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:17:32.070881-05:00","closed_at":"2026-01-20T18:17:32.070881-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.3","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:54:45.453556-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.3","depends_on_id":"herdctl-08m.2","type":"blocks","created_at":"2026-01-20T17:54:48.282695-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.4","title":"US-3: Mention Mode (Group Channels)","description":"As a Discord server admin, I want the bot to only respond when @mentioned so that it doesn't interrupt normal conversations.\n\n## Acceptance Criteria\n- [ ] Check if bot is mentioned in message\n- [ ] If not mentioned and mode is 'mention', ignore message\n- [ ] When mentioned, strip the mention from prompt before sending to Claude\n- [ ] Read recent message history for context (configurable, default 10 messages)\n- [ ] Include all messages but prioritize user's messages in context\n- [ ] Respond in the same channel\n- [ ] Unit tests for mention detection and context building\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:54:54.496568-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:24:03.665787-05:00","closed_at":"2026-01-20T18:24:03.665787-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.4","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:54:54.497159-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.4","depends_on_id":"herdctl-08m.3","type":"blocks","created_at":"2026-01-20T17:54:57.228141-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.5","title":"US-4: Auto Mode (DMs and Dedicated Channels)","description":"As a Discord user, I want the bot to respond to all my DMs so that I don't have to @mention it every time.\n\n## Acceptance Criteria\n- [ ] DMs default to auto mode\n- [ ] Channels can be configured as auto mode\n- [ ] No mention required in auto mode\n- [ ] Full conversation context maintained\n- [ ] DM allowlist/blocklist filtering supported\n- [ ] Unit tests for auto mode behavior\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:02.351666-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:28:08.837773-05:00","closed_at":"2026-01-20T18:28:08.837773-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.5","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:02.352242-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.5","depends_on_id":"herdctl-08m.4","type":"blocks","created_at":"2026-01-20T17:55:05.460037-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.6","title":"US-6: Slash Commands","description":"As a Discord user, I want slash commands to control the bot so that I can reset context or check status.\n\n## Commands\n- /help - Show available commands\n- /reset - Clear conversation context (start fresh session)\n- /status - Show agent status and session info\n\n## Acceptance Criteria\n- [ ] Register slash commands with Discord (per-bot, not global)\n- [ ] Handle command interactions\n- [ ] Respond ephemerally (only visible to user) for status/help\n- [ ] Confirm reset action\n- [ ] Commands are registered per-bot (each agent's bot has its own commands)\n- [ ] Create commands/ directory with index.ts, help.ts, reset.ts, status.ts\n- [ ] Unit tests for command handlers\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:11.866718-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:34:55.636849-05:00","closed_at":"2026-01-20T18:34:55.636849-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.6","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:11.8673-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.6","depends_on_id":"herdctl-08m.5","type":"blocks","created_at":"2026-01-20T17:55:14.60881-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.7","title":"US-7: Response Streaming \u0026 Formatting","description":"As a Discord user, I want to see the bot 'typing' while it thinks so that I know it's processing my message.\n\n## Acceptance Criteria\n- [ ] Send typing indicator while Claude is processing\n- [ ] Handle Discord message length limit (2000 chars)\n- [ ] Split long responses into multiple messages with brief delay between each\n- [ ] Maintain message coherence when splitting (don't break mid-sentence if possible)\n- [ ] Create utils/formatting.ts for message formatting utilities\n- [ ] Unit tests for message splitting logic\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:20.249559-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:40:57.674564-05:00","closed_at":"2026-01-20T18:40:57.674564-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.7","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:20.250101-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.7","depends_on_id":"herdctl-08m.6","type":"blocks","created_at":"2026-01-20T17:55:23.22155-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.8","title":"US-8: Rate Limit Handling","description":"As a developer, I want the connector to handle Discord rate limits gracefully so that messages aren't lost and the system remains stable.\n\n## Acceptance Criteria\n- [ ] Let discord.js handle rate limits automatically (queue and retry)\n- [ ] Emit events when rate limited so FleetManager can track status\n- [ ] Log rate limit occurrences at standard log level\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:28.820948-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:45:09.975288-05:00","closed_at":"2026-01-20T18:45:09.975288-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.8","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:28.821544-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.8","depends_on_id":"herdctl-08m.7","type":"blocks","created_at":"2026-01-20T17:55:31.374151-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-08m.9","title":"US-9: Error Handling","description":"As a Discord user, I want friendly error messages so that I know when something goes wrong.\n\n## Acceptance Criteria\n- [ ] Catch and handle common errors\n- [ ] User-friendly error messages (not stack traces)\n- [ ] Log detailed errors for debugging\n- [ ] Retry transient failures (rate limits, network)\n- [ ] Error responses: 'Sorry, I encountered an error processing your request. Please try again.' and 'I'm having trouble connecting right now. Please try again in a moment.'\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T17:55:36.67501-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T18:50:13.005962-05:00","closed_at":"2026-01-20T18:50:13.005962-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-08m.9","depends_on_id":"herdctl-08m","type":"parent-child","created_at":"2026-01-20T17:55:36.675585-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-08m.9","depends_on_id":"herdctl-08m.8","type":"blocks","created_at":"2026-01-20T17:55:39.336488-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq","title":"PRD 4: Agent Runner (herdctl-core-runner)","description":"Implement the agent runner module in packages/core/src/runner/. This module wraps the Claude Agent SDK to execute agents with proper configuration, permissions, MCP server support, and output handling. Integrates with existing config and state modules for complete agent execution lifecycle.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:02.626513-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:48:05.28909-05:00","closed_at":"2026-01-19T20:48:05.28909-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-prd-4-agent-runner-herdctl-core-runner.md","labels":["feature","ralph"]}
{"id":"herdctl-2dq.1","title":"US-1: Initialize SDK with Agent Config","description":"As a fleet operator, I want to execute an agent using the Claude Agent SDK so that I can run autonomous agents with proper configuration.\n\n## Acceptance Criteria\n- [ ] Accepts `ResolvedAgentConfig` from the config module\n- [ ] Initializes the SDK's `query` function with agent-specific options\n- [ ] Passes `systemPrompt` from agent config (or uses `claude_code` preset)\n- [ ] Sets `settingSources` to `[\"project\", \"local\"]` for proper settings discovery\n- [ ] Works with the async iterator pattern from the SDK\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:13.953112-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:01:34.398382-05:00","closed_at":"2026-01-19T20:01:34.398382-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.1","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:13.953823-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.2","title":"US-2: Pass MCP Servers from Agent Config","description":"As a fleet operator, I want to configure MCP servers per-agent so that each agent has access to its required tools and integrations.\n\n## Acceptance Criteria\n- [ ] Transforms agent's `mcp_servers` config to SDK's `mcpServers` format\n- [ ] Supports HTTP-based MCP servers (`type: \"http\"`, `url`)\n- [ ] Supports process-based MCP servers (`command`, `args`, `env`)\n- [ ] Interpolates environment variables in MCP config (e.g., `${GITHUB_TOKEN}`)\n- [ ] Passes empty object when no MCP servers configured\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:20.242247-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:04:10.903795-05:00","closed_at":"2026-01-19T20:04:10.903795-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.2","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:20.242971-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.3","title":"US-3: Pass Allowed Tools and Permission Mode","description":"As a fleet operator, I want to control which tools an agent can use so that I can enforce security boundaries per agent.\n\n## Acceptance Criteria\n- [ ] Maps agent's `permissions.mode` to SDK's `permissionMode`\n- [ ] Supports all four modes: `default`, `acceptEdits`, `bypassPermissions`, `plan`\n- [ ] Passes `permissions.allowed_tools` as SDK's `allowedTools` array\n- [ ] Passes `permissions.denied_tools` as SDK's `deniedTools` array (if supported)\n- [ ] Defaults to `acceptEdits` mode when not specified\n- [ ] Supports MCP tool wildcards (e.g., `mcp__posthog__*`)\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:26.452788-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:06:13.272729-05:00","closed_at":"2026-01-19T20:06:13.272729-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.3","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:26.453389-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.4","title":"US-4: Stream Output to Job Log","description":"As a fleet operator, I want to capture all agent output in real-time so that I can monitor agent activity and debug issues.\n\n## Acceptance Criteria\n- [ ] Creates job record via `createJob()` before starting execution\n- [ ] Updates job status to `running` via `updateJob()`\n- [ ] Writes each SDK message to job output via `appendJobOutput()`\n- [ ] Handles all message types: `system`, `assistant`, `tool_use`, `tool_result`, `error`\n- [ ] Preserves message content and metadata in JSONL format\n- [ ] Writes output immediately (no buffering) for real-time monitoring\n- [ ] Updates job with final status when execution completes\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:32.50232-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:12:41.582611-05:00","closed_at":"2026-01-19T20:12:41.582611-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.4","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:32.50291-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.4","depends_on_id":"herdctl-2dq.1","type":"blocks","created_at":"2026-01-19T19:53:15.152546-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.4","depends_on_id":"herdctl-2dq.2","type":"blocks","created_at":"2026-01-19T19:53:15.223953-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.4","depends_on_id":"herdctl-2dq.3","type":"blocks","created_at":"2026-01-19T19:53:15.296822-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.5","title":"US-5: Capture Session ID for Resume/Fork","description":"As a fleet operator, I want to capture and persist the Claude session ID so that I can resume or fork agent sessions later.\n\n## Acceptance Criteria\n- [ ] Extracts `session_id` from `system` message with `subtype: \"init\"`\n- [ ] Updates job metadata with `session_id` once captured\n- [ ] Persists session info via `updateSessionInfo()` for resume capability\n- [ ] Stores agent name, session ID, timestamps, and job count\n- [ ] Session ID available in `RunnerResult` for caller use\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:38.65868-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:16:43.412331-05:00","closed_at":"2026-01-19T20:16:43.412331-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.5","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:38.659244-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.5","depends_on_id":"herdctl-2dq.4","type":"blocks","created_at":"2026-01-19T19:53:21.4604-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.6","title":"US-6: Support Session Resume and Fork","description":"As a fleet operator, I want to resume or fork existing sessions so that agents can maintain context or branch into new conversations.\n\n## Acceptance Criteria\n- [ ] Accepts optional `resume` parameter with session ID\n- [ ] Passes `resume: sessionId` to SDK for session resumption\n- [ ] Accepts optional `fork` parameter for forking sessions\n- [ ] Passes `forkSession: true` to SDK when forking\n- [ ] Creates job with `trigger_type: \"fork\"` and `forked_from` when forking\n- [ ] Updates session info after resume/fork with new job count\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:44.913752-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:20:51.96118-05:00","closed_at":"2026-01-19T20:20:51.96118-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.6","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:44.914334-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.6","depends_on_id":"herdctl-2dq.5","type":"blocks","created_at":"2026-01-19T19:53:21.53246-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.7","title":"US-7: Handle SDK Errors Gracefully","description":"As a fleet operator, I want graceful error handling when things go wrong so that failures are logged and reported properly.\n\n## Acceptance Criteria\n- [ ] Catches SDK initialization errors (e.g., missing API key)\n- [ ] Catches SDK streaming errors during execution\n- [ ] Logs error messages to job output as `error` type messages\n- [ ] Updates job status to `failed` with appropriate `exit_reason`\n- [ ] Provides descriptive error messages with context (job ID, agent name)\n- [ ] Returns error details in `RunnerResult`\n- [ ] Does not crash on malformed SDK responses\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:51.36977-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:29:17.245331-05:00","closed_at":"2026-01-19T20:29:17.245331-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.7","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:51.37037-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.7","depends_on_id":"herdctl-2dq.4","type":"blocks","created_at":"2026-01-19T19:53:21.602415-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.8","title":"US-8: Extract Summary from Final Response","description":"As a fleet operator, I want to capture a summary of what the agent accomplished so that I can quickly understand job outcomes.\n\n## Acceptance Criteria\n- [ ] Extracts summary from final `assistant` message content\n- [ ] Truncates summary to reasonable length (500 chars max)\n- [ ] Stores summary in job metadata via `updateJob()`\n- [ ] Returns summary in `RunnerResult`\n- [ ] Handles cases where no final assistant message exists\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:52:56.316638-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:32:31.073581-05:00","closed_at":"2026-01-19T20:32:31.073581-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.8","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:52:56.317197-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.8","depends_on_id":"herdctl-2dq.4","type":"blocks","created_at":"2026-01-19T19:53:21.672528-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2dq.9","title":"US-9: Update Documentation","description":"As a developer using herdctl, I want to understand how the runner works so that I can effectively use and debug agent execution.\n\n## Acceptance Criteria\n- [ ] Add **Runner** section to docs site under Internals\n- [ ] Document SDK integration and async iterator pattern\n- [ ] Explain all four permission modes with examples\n- [ ] Document MCP server configuration options\n- [ ] Explain session management (resume/fork)\n- [ ] Document output streaming format and JSONL structure\n- [ ] Include error handling patterns and troubleshooting\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of runner module\n- [ ] Documentation builds successfully (pnpm build in docs/)","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T19:53:02.588822-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T20:37:01.880328-05:00","closed_at":"2026-01-19T20:37:01.880328-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2dq.9","depends_on_id":"herdctl-2dq","type":"parent-child","created_at":"2026-01-19T19:53:02.589375-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.9","depends_on_id":"herdctl-2dq.6","type":"blocks","created_at":"2026-01-19T19:53:25.952518-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.9","depends_on_id":"herdctl-2dq.7","type":"blocks","created_at":"2026-01-19T19:53:26.024376-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2dq.9","depends_on_id":"herdctl-2dq.8","type":"blocks","created_at":"2026-01-19T19:53:26.093835-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw","title":"Runner Integration \u0026 FleetManager Refactor","description":"Wire handleScheduleTrigger to JobExecutor so schedules actually run Claude. Break fleet-manager.ts (2316 lines) into focused modules under 500 lines each. Preserve all public APIsâ€”existing tests must pass without modification.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:09.653948-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:04:10.669291-05:00","closed_at":"2026-01-26T22:04:10.669291-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-runner-integration-fleetmanager-refactor.md","labels":["feature","ralph"]}
{"id":"herdctl-2pw.1","title":"US-2: SDK Dependency Injection","description":"As a developer writing tests, I want to inject a mock SDK query function so that I can test FleetManager without real Claude API calls.\n\n## Acceptance Criteria\n- [ ] `FleetManagerOptions` accepts optional `sdkQuery` parameter\n- [ ] When provided, `JobExecutor` uses it instead of real SDK\n- [ ] Existing tests continue to work unchanged\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:20.804979-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:33:42.477498-05:00","closed_at":"2026-01-20T19:33:42.477498-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.1","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:20.805613-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.2","title":"US-4: Extract Event Emitters Module","description":"As a maintainer, I want event emission logic centralized so that event contracts are clear and consistent.\n\n## Acceptance Criteria\n- [ ] Extract to `event-emitters.ts` (~100 lines)\n- [ ] All `emitXxx` helper methods moved here\n- [ ] Type-safe event emission preserved\n- [ ] All existing tests pass\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:25.310221-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:36:20.938409-05:00","closed_at":"2026-01-20T19:36:20.938409-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.2","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:25.310818-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.2","depends_on_id":"herdctl-2pw.1","type":"blocks","created_at":"2026-01-20T19:29:10.06338-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.3","title":"US-3: Extract Status Queries Module","description":"As a maintainer, I want status query methods in a separate module so that the code is easier to understand and modify.\n\n## Acceptance Criteria\n- [ ] Extract to `status-queries.ts` (~300 lines)\n- [ ] Methods: `getFleetStatus`, `getAgentInfo`, `getJobHistory`, related helpers\n- [ ] FleetManager delegates to this module\n- [ ] All existing tests pass\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:29.781065-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:40:53.603296-05:00","closed_at":"2026-01-20T19:40:53.603296-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.3","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:29.781628-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.3","depends_on_id":"herdctl-2pw.2","type":"blocks","created_at":"2026-01-20T19:29:14.248587-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.4","title":"US-5: Extract Schedule Management Module","description":"As a maintainer, I want schedule operations in a dedicated module so that scheduling logic is cohesive.\n\n## Acceptance Criteria\n- [ ] Extract to `schedule-management.ts` (~200 lines)\n- [ ] Methods: `getSchedules`, `enableSchedule`, `disableSchedule`, schedule helpers\n- [ ] All existing tests pass\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:33.853943-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:43:39.069473-05:00","closed_at":"2026-01-20T19:43:39.069473-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.4","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:33.854525-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.4","depends_on_id":"herdctl-2pw.3","type":"blocks","created_at":"2026-01-20T19:29:18.332086-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.5","title":"US-6: Extract Config Reload Module","description":"As a maintainer, I want config reload logic isolated so that the complex diffing logic is easier to maintain.\n\n## Acceptance Criteria\n- [ ] Extract to `config-reload.ts` (~300 lines)\n- [ ] Methods: `reload`, `computeConfigChanges`, diff helpers\n- [ ] All existing tests pass\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:37.722883-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:47:00.846398-05:00","closed_at":"2026-01-20T19:47:00.846398-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.5","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:37.723435-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.5","depends_on_id":"herdctl-2pw.4","type":"blocks","created_at":"2026-01-20T19:29:22.403748-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.6","title":"US-7: Extract Job Control Module","description":"As a maintainer, I want job operations in a dedicated module so that job lifecycle is clearly defined.\n\n## Acceptance Criteria\n- [ ] Extract to `job-control.ts` (~350 lines)\n- [ ] Methods: `trigger`, `cancelJob`, `forkJob`, job helpers\n- [ ] All existing tests pass\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:41.315811-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:52:58.036378-05:00","closed_at":"2026-01-20T19:52:58.036378-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.6","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:41.316373-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.6","depends_on_id":"herdctl-2pw.5","type":"blocks","created_at":"2026-01-20T19:29:26.493897-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.7","title":"US-8: Extract Log Streaming Module","description":"As a maintainer, I want streaming logic separated so that the async generator patterns are isolated.\n\n## Acceptance Criteria\n- [ ] Extract to `log-streaming.ts` (~450 lines)\n- [ ] Methods: `streamLogs`, `streamJobOutput`, `streamAgentLogs`\n- [ ] All existing tests pass\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:45.465022-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T19:57:21.272152-05:00","closed_at":"2026-01-20T19:57:21.272152-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.7","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:45.465633-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.7","depends_on_id":"herdctl-2pw.6","type":"blocks","created_at":"2026-01-20T19:29:30.270647-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.8","title":"US-1: Runner Integration","description":"As a user with scheduled agents, I want schedules to actually execute Claude so that my automated workflows run without manual intervention.\n\n## Acceptance Criteria\n- [ ] `handleScheduleTrigger` calls `JobExecutor.execute()` with the agent and schedule prompt\n- [ ] A job record is created in state before execution starts\n- [ ] Job output streams to `job:output` events\n- [ ] `job:started` and `job:completed`/`job:failed` events emit appropriately\n- [ ] On failure: emit error event, log, continue (don't crash the fleet)\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes\n- [ ] Manual test: `herdctl run my-agent` produces Claude output\n- [ ] Manual test: Scheduled trigger executes Claude (not just logs)","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:52.195221-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T20:02:28.62801-05:00","closed_at":"2026-01-20T20:02:28.62801-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.8","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:52.195778-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.8","depends_on_id":"herdctl-2pw.7","type":"blocks","created_at":"2026-01-20T19:29:33.867242-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-2pw.9","title":"US-9: Configurable Output Logging","description":"As a user, I want to configure whether job output is logged to files so that I can choose between disk usage and debuggability.\n\n## Acceptance Criteria\n- [ ] Schedule config accepts optional `outputToFile: boolean` (default: false)\n- [ ] When true, output also written to `.herdctl/jobs/{jobId}/output.log`\n- [ ] Events always stream regardless of this setting\n- [ ] `pnpm typecheck` passes\n- [ ] `pnpm test` passes","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T19:28:57.621576-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T20:07:57.17495-05:00","closed_at":"2026-01-20T20:07:57.17495-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-2pw.9","depends_on_id":"herdctl-2pw","type":"parent-child","created_at":"2026-01-20T19:28:57.622208-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-2pw.9","depends_on_id":"herdctl-2pw.8","type":"blocks","created_at":"2026-01-20T19:29:37.235573-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay","title":"State Management Foundation","description":"Implement the state management foundation for herdctl in packages/core/src/state/. This module manages the .herdctl/ directory structure, providing persistent storage for fleet state, job metadata, job output logs, agent sessions, and runtime information. All state is file-based (no database required), using YAML for structured data and JSONL for streaming logs.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:18.317057-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:47:30.433547-05:00","closed_at":"2026-01-19T19:47:30.433547-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-prd-2-state-management.md","labels":["feature","ralph"]}
{"id":"herdctl-3ay.1","title":"US-1: Initialize State Directory Structure","description":"As a fleet operator, I want to have herdctl automatically create and manage the .herdctl/ directory so that all state files are organized and accessible.\n\n## Acceptance Criteria\n- [ ] Creates .herdctl/ directory in the project root if it doesn't exist\n- [ ] Creates subdirectories: jobs/, sessions/, logs/\n- [ ] Creates state.yaml with empty/initial fleet state if it doesn't exist\n- [ ] Validates directory structure on initialization\n- [ ] Returns StateDirectory object with paths to all subdirectories\n- [ ] Throws descriptive errors if directories cannot be created (e.g., permission denied)\n- [ ] Supports custom state directory path via options (default: .herdctl/ in CWD)\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:25.740138-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T17:53:39.713575-05:00","closed_at":"2026-01-19T17:53:39.713575-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.1","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:30:25.740735-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-3ay.1","depends_on_id":"herdctl-3ay.5","type":"blocks","created_at":"2026-01-19T17:31:13.440634-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-3ay.1","depends_on_id":"herdctl-3ay.7","type":"blocks","created_at":"2026-01-19T17:31:13.51583-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay.2","title":"US-2: Read/Write Fleet State (state.yaml)","description":"As a fleet operator, I want to persist fleet-wide state across restarts so that agents resume from their last known state.\n\n## Acceptance Criteria\n- [ ] Reads state.yaml and validates against FleetStateSchema\n- [ ] Returns typed FleetState object with:\n  - fleet.started_at - when the fleet was started\n  - agents - map of agent name to AgentState (status, current_job, last_job, next_schedule, next_trigger_at, container_id, error_message)\n- [ ] Writes FleetState back to state.yaml atomically\n- [ ] Handles missing file gracefully (returns default empty state)\n- [ ] Handles corrupted file gracefully (logs warning, returns default state)\n- [ ] Provides updateAgentState(agentName, updates) for partial updates\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:32.287745-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T17:57:25.224194-05:00","closed_at":"2026-01-19T17:57:25.224194-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.2","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:30:32.288291-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-3ay.2","depends_on_id":"herdctl-3ay.1","type":"blocks","created_at":"2026-01-19T17:31:17.566743-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay.3","title":"US-3: Read/Write Job Metadata (job-\u003cid\u003e.yaml)","description":"As a fleet operator, I want to persist job metadata for history and debugging so that I can track what each job did and when.\n\n## Acceptance Criteria\n- [ ] Creates job metadata file at .herdctl/jobs/job-\u003cid\u003e.yaml\n- [ ] Validates against JobMetadataSchema with fields: id, agent, schedule, trigger_type, status, exit_reason, session_id, forked_from, started_at, finished_at, duration_seconds, prompt, summary, output_file\n- [ ] Provides createJob(), updateJob(), getJob(), listJobs() functions\n- [ ] updateJob() uses atomic writes to prevent corruption\n- [ ] listJobs() supports filtering by agent, status, and date range\n- [ ] Generates unique job IDs with format: job-YYYY-MM-DD-\u003crandom6\u003e\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:38.751256-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:09:26.33181-05:00","closed_at":"2026-01-19T18:09:26.33181-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.3","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:30:38.751858-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-3ay.3","depends_on_id":"herdctl-3ay.1","type":"blocks","created_at":"2026-01-19T17:31:21.239569-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay.4","title":"US-4: Append to Job Output Logs (job-\u003cid\u003e.jsonl)","description":"As a fleet operator, I want to stream job output to a persistent log file so that I can replay, monitor, and debug job execution.\n\n## Acceptance Criteria\n- [ ] Creates output file at .herdctl/jobs/job-\u003cid\u003e.jsonl\n- [ ] Appends JSONL messages from Claude SDK streaming output\n- [ ] Each line is a valid JSON object with at minimum: type, timestamp\n- [ ] Supports SDK message types: system, assistant, tool_use, tool_result, error\n- [ ] Provides appendJobOutput(jobId, message) function (single message)\n- [ ] Provides appendJobOutputBatch(jobId, messages) function (multiple messages)\n- [ ] Provides readJobOutput(jobId) async generator for streaming reads\n- [ ] Provides getJobOutputPath(jobId) for direct file access\n- [ ] Handles concurrent appends safely (uses append mode)\n- [ ] Validates message structure before writing\n- [ ] Does NOT buffer - writes immediately for real-time monitoring\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:45.988252-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:15:32.706145-05:00","closed_at":"2026-01-19T18:15:32.706145-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.4","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:30:45.988821-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-3ay.4","depends_on_id":"herdctl-3ay.3","type":"blocks","created_at":"2026-01-19T17:31:25.515873-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay.5","title":"US-5: Atomic Writes to Prevent Corruption","description":"As a fleet operator, I want to ensure state files are never corrupted during writes so that my fleet state survives crashes and restarts.\n\n## Acceptance Criteria\n- [ ] All YAML writes use atomic write pattern (write to temp file, then rename)\n- [ ] Temp files are written to same directory as target (ensures same filesystem)\n- [ ] Temp files use pattern: .\u003cfilename\u003e.tmp.\u003crandom\u003e\n- [ ] Rename operation is atomic on POSIX systems\n- [ ] On Windows, uses rename with retry logic for best-effort atomicity\n- [ ] JSONL appends use fs.appendFile (atomic at message level on most systems)\n- [ ] Provides atomicWriteFile(path, content) utility function\n- [ ] Cleans up temp files on failure\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:54.547598-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T17:42:30.554739-05:00","closed_at":"2026-01-19T17:42:30.554739-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.5","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:30:54.548157-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay.6","title":"US-6: Session State Management","description":"As a fleet operator, I want to persist Claude session information per agent so that I can resume or fork sessions later.\n\n## Acceptance Criteria\n- [ ] Stores session info at .herdctl/sessions/\u003cagent-name\u003e.json\n- [ ] Validates against SessionInfoSchema with fields: agent_name, session_id, created_at, last_used_at, job_count, mode\n- [ ] Provides getSessionInfo(agentName), updateSessionInfo(agentName, info), clearSession(agentName)\n- [ ] Handles missing file gracefully (returns null)\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:30:59.964751-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:21:40.375238-05:00","closed_at":"2026-01-19T18:21:40.375238-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.6","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:30:59.965374-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-3ay.6","depends_on_id":"herdctl-3ay.1","type":"blocks","created_at":"2026-01-19T17:31:29.978005-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-3ay.7","title":"US-7: Concurrent Read Safety","description":"As a fleet operator, I want to read state from multiple CLI instances simultaneously so that I can monitor agents while they're running.\n\n## Acceptance Criteria\n- [ ] Read operations don't require locks\n- [ ] Read operations handle file being written to (retry on partial read)\n- [ ] YAML parsing handles empty/truncated files gracefully\n- [ ] JSONL reading handles incomplete last line (truncates to last valid line)\n- [ ] Provides safeReadYaml(path) utility with retry logic\n- [ ] Provides safeReadJsonl(path) utility that handles partial lines\n\n## Quality Gates\n- [ ] pnpm typecheck passes in packages/core\n- [ ] pnpm test passes with \u003e90% coverage of state module","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T17:31:06.104554-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T17:48:02.325929-05:00","closed_at":"2026-01-19T17:48:02.325929-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-3ay.7","depends_on_id":"herdctl-3ay","type":"parent-child","created_at":"2026-01-19T17:31:06.105134-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-4ji","title":"Phase 6: Unit Tests","description":"Comprehensive unit tests for DiscordManager achieving 85% line coverage.\n\n## Files to Create\n- packages/core/src/fleet-manager/__tests__/discord-manager.test.ts\n\n## Test Categories\n\n### 1. Constructor Tests\n- Creates connectors for Discord-configured agents only\n- Skips agents without chat.discord config\n- Handles empty agents array\n- Handles config with no Discord agents\n\n### 2. Lifecycle Tests\n- start() connects all connectors\n- start() handles partial failures gracefully\n- stop() disconnects all connectors\n- stop() handles already-disconnected connectors\n- Concurrent start/stop handling\n\n### 3. Message Handling Tests\n- Routes messages to correct agent\n- Strips mention from prompt\n- Creates job context correctly\n- Handles missing session gracefully\n- Handles JobExecutor errors\n\n### 4. Response Delivery Tests\n- Collects full response\n- Splits long responses correctly\n- Preserves code blocks when splitting\n- Handles empty responses\n- Formats error messages correctly\n\n### 5. Session Integration Tests\n- Loads sessions on startup\n- Saves sessions on message\n- Clears session on /reset\n- Handles session expiry\n\n### Mock Strategy\n```typescript\n// Mock DiscordConnector\nconst mockConnector = {\n  connect: vi.fn(),\n  disconnect: vi.fn(),\n  on: vi.fn(),\n  sendMessage: vi.fn(),\n  sessionManager: {\n    get: vi.fn(),\n    create: vi.fn(),\n    getAll: vi.fn(),\n    restore: vi.fn(),\n  },\n};\n\n// Mock JobExecutor\nconst mockJobExecutor = {\n  execute: vi.fn(),\n};\n```\n\n## Acceptance Criteria\n- [ ] All test categories implemented\n- [ ] Mocked DiscordConnector for isolation\n- [ ] Mocked JobExecutor for isolation\n- [ ] Tests cover happy path and error cases\n- [ ] 85% line coverage achieved\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T22:00:38.901446-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:34:49.62906-05:00","closed_at":"2026-01-26T22:34:49.62906-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-4ji","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T22:00:41.574436-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-4ji","depends_on_id":"herdctl-5z2","type":"blocks","created_at":"2026-01-26T22:00:41.651375-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5fg","title":"Phase 1: DiscordManager Foundation","description":"Create the DiscordManager module following the existing FleetManager module pattern (like ScheduleExecutor).\n\n## Files to Create\n- packages/core/src/fleet-manager/discord-manager.ts\n\n## Implementation Details\n\n### DiscordManagerContext Interface\n```typescript\ninterface DiscordManagerContext {\n  config: FleetConfig;\n  jobExecutor: JobExecutor;\n  stateManager: StateManager;\n  eventBus: EventEmitter;\n}\n```\n\n### DiscordManager Class\n- Constructor receives DiscordManagerContext\n- Creates one DiscordConnector instance per agent that has `chat.discord` configured\n- Stores connectors in a Map\u003cagentName, DiscordConnector\u003e\n- Implements start() method to connect all connectors\n- Implements stop() method to gracefully disconnect all connectors\n- Exposes getConnector(agentName) for status queries\n\n### Pattern Reference\nLook at packages/core/src/fleet-manager/schedule-executor.ts as the template for:\n- Context injection pattern\n- Lifecycle management (start/stop)\n- Error handling patterns\n\n## Acceptance Criteria\n- [ ] DiscordManager class created with context injection pattern\n- [ ] Constructor iterates agents and creates connectors for Discord-configured ones\n- [ ] start() method connects all connectors\n- [ ] stop() method disconnects all connectors gracefully\n- [ ] Connectors stored in Map for lookup by agent name\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds\n\n## Dependencies\n- Requires @herdctl/discord package (already exists at v0.0.2)","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T21:59:31.924454-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:10:25.46506-05:00","closed_at":"2026-01-26T22:10:25.46506-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5fg","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T21:59:37.343781-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh","title":"Work Sources (GitHub First, Extensible)","description":"Implement the work sources foundation for herdctl in packages/core/src/work-sources/. This module provides a pluggable adapter pattern for task discovery and lifecycle management, enabling agents to fetch work from external systems. Implements the GitHub Issues adapter while establishing an extensible architecture for future integrations (Beads, Linear, Jira, Notion).","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-19T21:35:36.114073-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:24:48.87154-05:00","closed_at":"2026-01-19T22:24:48.87154-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-prd-5-work-sources-github-first-extensible.md","labels":["feature","ralph"]}
{"id":"herdctl-5lh.1","title":"US-1: Define WorkSource Interface","description":"As a herdctl developer, I want to have a common WorkSource interface so that all work source adapters share a consistent contract.\n\n## Acceptance Criteria\n- [ ] `WorkSource` interface defines `type`, `fetchAvailableWork()`, `claimWork()`, `completeWork()`, `releaseWork()`, `getWork()`\n- [ ] `WorkItem` type captures common fields: `id`, `source`, `externalId`, `title`, `description`, `priority`, `labels`, `metadata`, `url`, `createdAt`, `updatedAt`\n- [ ] `FetchOptions` supports filtering and pagination\n- [ ] `ClaimResult` indicates success/failure with reason\n- [ ] `WorkResult` captures completion outcome (success, failure, partial)\n- [ ] All types are exported from `packages/core/src/work-sources/index.ts`\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:35:46.013495-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T21:42:48.249787-05:00","closed_at":"2026-01-19T21:42:48.249787-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.1","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:35:46.014119-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.2","title":"US-2: Create Work Source Registry","description":"As a herdctl developer, I want to register and resolve work source adapters by type so that adding new adapters requires no changes to core code.\n\n## Acceptance Criteria\n- [ ] `registerWorkSource(type: string, factory: WorkSourceFactory)` registers adapters\n- [ ] `getWorkSource(config: WorkSourceConfig)` returns configured adapter instance\n- [ ] Factory pattern allows config-based instantiation\n- [ ] Built-in adapters (GitHub) are pre-registered at module load\n- [ ] Throws `UnknownWorkSourceError` for unregistered types\n- [ ] Registry is singleton per process (module-level state)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:35:53.128729-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T21:49:35.585087-05:00","closed_at":"2026-01-19T21:49:35.585087-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.2","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:35:53.129361-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.2","depends_on_id":"herdctl-5lh.1","type":"blocks","created_at":"2026-01-19T21:36:57.041779-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.3","title":"US-3: Implement GitHub Issues Adapter","description":"As a fleet operator, I want to use GitHub Issues as my work source so that agents can work on issues labeled as ready.\n\n## Acceptance Criteria\n- [ ] Queries issues by `labels.ready` label (configurable, default: `ready`)\n- [ ] Excludes issues with `exclude_labels` (default: `[\"blocked\", \"wip\"]`)\n- [ ] Returns issues sorted by creation date (oldest first)\n- [ ] Supports pagination for repos with many issues\n- [ ] Maps GitHub issue fields to `WorkItem` format\n- [ ] Handles GitHub API errors gracefully\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:36:02.149922-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T21:57:49.379608-05:00","closed_at":"2026-01-19T21:57:49.379608-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.3","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:36:02.150534-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.3","depends_on_id":"herdctl-5lh.2","type":"blocks","created_at":"2026-01-19T21:36:57.125791-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.4","title":"US-4: Implement GitHub Issue Lifecycle","description":"As a fleet operator, I want agents to claim, complete, and release issues so that work items move through a defined workflow.\n\n## Acceptance Criteria\n- [ ] `claimWork(taskId)`: Removes `ready` label, adds `in_progress` label (configurable)\n- [ ] `completeWork(taskId, result)`: Closes issue, removes `in_progress` label, adds completion comment with summary\n- [ ] `releaseWork(taskId, reason)`: Removes `in_progress` label, re-adds `ready` label (for failures/timeouts)\n- [ ] `getWork(taskId)`: Fetches single issue by number\n- [ ] Handles concurrent claim attempts (detects if already claimed)\n- [ ] Respects `cleanup_on_failure` config option\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:36:09.66171-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T21:59:50.842078-05:00","closed_at":"2026-01-19T21:59:50.842078-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.4","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:36:09.662436-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.4","depends_on_id":"herdctl-5lh.3","type":"blocks","created_at":"2026-01-19T21:36:57.209487-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.5","title":"US-5: Handle GitHub API Edge Cases","description":"As a fleet operator, I want robust handling of GitHub API limitations so that agents don't fail due to transient issues.\n\n## Acceptance Criteria\n- [ ] Implements exponential backoff for rate limit errors (HTTP 403 with `X-RateLimit-Remaining: 0`)\n- [ ] Detects and surfaces rate limit status (remaining, reset time)\n- [ ] Handles network errors with retries (max 3 attempts)\n- [ ] Handles 404 errors gracefully (issue deleted/moved)\n- [ ] Validates PAT has required scopes (issues read/write)\n- [ ] Logs warnings for approaching rate limit (\u003c 100 remaining)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:36:17.41316-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:07:36.471247-05:00","closed_at":"2026-01-19T22:07:36.471247-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.5","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:36:17.413825-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.5","depends_on_id":"herdctl-5lh.3","type":"blocks","created_at":"2026-01-19T21:36:57.291502-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.6","title":"US-6: Extend Config Schema for GitHub Work Source","description":"As a fleet operator, I want to configure GitHub work source settings in YAML so that I can customize the workflow per agent.\n\n## Acceptance Criteria\n- [ ] Extends `WorkSourceSchema` with GitHub-specific fields\n- [ ] Supports `repo` field (required, format: `owner/repo`)\n- [ ] Supports `labels.ready` and `labels.in_progress` (optional, with defaults)\n- [ ] Supports `exclude_labels` array (optional)\n- [ ] Supports `cleanup_on_failure` boolean (default: true)\n- [ ] Supports `auth.token_env` for PAT environment variable\n- [ ] Schema validation provides clear error messages\n- [ ] Types are exported and available to other modules\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:36:25.556968-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:11:36.931045-05:00","closed_at":"2026-01-19T22:11:36.931045-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.6","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:36:25.55765-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.6","depends_on_id":"herdctl-5lh.1","type":"blocks","created_at":"2026-01-19T21:36:57.378551-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.7","title":"US-7: Define Scheduler Integration Interface","description":"As a herdctl developer, I want a clean interface between work sources and the scheduler/runner so that future scheduler implementation has clear contracts.\n\n## Acceptance Criteria\n- [ ] `WorkSourceManager` interface for scheduler to use\n- [ ] `getNextWorkItem(agent: ResolvedAgent)` returns next available work or null\n- [ ] `reportOutcome(taskId: string, result: WorkResult)` reports job completion\n- [ ] Handles work source instantiation and caching per agent\n- [ ] Does NOT implement scheduler logic (interface only)\n- [ ] Documents expected usage patterns in code comments\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:36:38.656348-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:16:44.350708-05:00","closed_at":"2026-01-19T22:16:44.350708-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.7","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:36:38.660465-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.7","depends_on_id":"herdctl-5lh.2","type":"blocks","created_at":"2026-01-19T21:36:57.464155-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5lh.8","title":"US-8: Update Documentation","description":"As a herdctl user, I want comprehensive documentation on work sources so that I can configure GitHub Issues integration correctly.\n\n## Acceptance Criteria\n- [ ] Create \"Work Sources\" concept page in docs explaining the adapter pattern\n- [ ] Create \"GitHub Issues\" configuration guide with YAML examples\n- [ ] Document the label-based workflow with diagram\n- [ ] Document rate limiting considerations and best practices\n- [ ] Document PAT token requirements and scope recommendations\n- [ ] pnpm typecheck passes\n- [ ] pnpm build in docs/ passes","status":"closed","priority":4,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T21:36:45.297361-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:21:49.02747-05:00","closed_at":"2026-01-19T22:21:49.02747-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5lh.8","depends_on_id":"herdctl-5lh","type":"parent-child","created_at":"2026-01-19T21:36:45.297984-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.8","depends_on_id":"herdctl-5lh.4","type":"blocks","created_at":"2026-01-19T21:36:57.54869-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.8","depends_on_id":"herdctl-5lh.5","type":"blocks","created_at":"2026-01-19T21:36:57.632268-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.8","depends_on_id":"herdctl-5lh.6","type":"blocks","created_at":"2026-01-19T21:36:57.711367-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5lh.8","depends_on_id":"herdctl-5lh.7","type":"blocks","created_at":"2026-01-19T21:36:57.792842-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-5z2","title":"Phase 5: Session Persistence","description":"Integrate SessionManager with StateManager for persistent sessions across restarts.\n\n## Files to Modify\n- packages/core/src/fleet-manager/discord-manager.ts\n- packages/discord/src/session-manager.ts (if needed)\n\n## Implementation Details\n\n### Session Storage\nSessions should persist to .herdctl/discord-sessions/\u003cagent-name\u003e.json:\n```typescript\ninterface PersistedSession {\n  channelId: string;\n  sessionId: string;\n  lastMessageAt: string; // ISO timestamp\n}\n```\n\n### StateManager Integration\nUse the existing StateManager for persistence:\n```typescript\n// On session create/update\nawait this.context.stateManager.saveDiscordSession(agentName, session);\n\n// On connector startup\nconst sessions = await this.context.stateManager.loadDiscordSessions(agentName);\nconnector.sessionManager.restore(sessions);\n```\n\n### Session Lifecycle\n1. On connector startup: load persisted sessions\n2. On message: get/create session, update lastMessageAt, persist\n3. On /reset command: clear session for channel, persist\n4. Session expiry: handled by SessionManager based on config timeout\n\n### Graceful Shutdown\nOn DiscordManager.stop():\n```typescript\n// Persist all active sessions before disconnecting\nfor (const [agentName, connector] of this.connectors) {\n  const sessions = connector.sessionManager.getAll();\n  await this.context.stateManager.saveDiscordSessions(agentName, sessions);\n}\n```\n\n## Acceptance Criteria\n- [ ] Sessions persist to .herdctl/ directory\n- [ ] Sessions loaded on connector startup\n- [ ] Sessions saved on message handling\n- [ ] /reset command clears channel session\n- [ ] Sessions survive bot restarts\n- [ ] Session expiry respects maxHistoryLength config\n- [ ] Graceful shutdown saves all sessions\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T22:00:26.266028-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:26:17.861197-05:00","closed_at":"2026-01-26T22:26:17.861197-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-5z2","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T22:00:28.795063-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-5z2","depends_on_id":"herdctl-t83","type":"blocks","created_at":"2026-01-26T22:00:28.875174-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-cay","title":"Cron Expression Support for Scheduler","description":"Add cron expression support to the herdctl scheduler module alongside existing interval-based scheduling. This enables users to trigger agents at specific times (e.g., 'every day at 9am', 'weekdays at 9:30am') using standard cron syntax.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-20T16:15:13.512781-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:04:10.82803-05:00","closed_at":"2026-01-26T22:04:10.82803-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-herdctl-core-cron.md","labels":["feature","ralph"]}
{"id":"herdctl-cay.1","title":"US-1: Parse Cron Expressions","description":"As a developer configuring agents, I want to use standard cron expressions in my schedule config so that I can trigger agents at specific times.\n\n## Acceptance Criteria\n- [ ] New `cron.ts` module alongside `interval.ts` in `packages/core/src/scheduler/`\n- [ ] `parseCronExpression(expression: string)` function using `cron-parser` library\n- [ ] Support standard 5-field cron: `minute hour day-of-month month day-of-week`\n- [ ] Support common shorthands: `@daily`, `@hourly`, `@weekly`, `@monthly`, `@yearly`\n- [ ] Throws `CronParseError` for invalid expressions\n- [ ] Add `cron-parser` dependency to `packages/core/package.json`\n- [ ] Export cron functions from `packages/core/src/scheduler/index.ts`\n\n## Quality Gates\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes with coverage thresholds (85% lines/functions/statements, 65% branches)","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T16:15:19.49668-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T16:22:02.250184-05:00","closed_at":"2026-01-20T16:22:02.250184-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-cay.1","depends_on_id":"herdctl-cay","type":"parent-child","created_at":"2026-01-20T16:15:19.497276-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-cay.2","title":"US-2: Calculate Next Cron Trigger","description":"As a scheduler, I want to calculate when a cron schedule should next trigger so that agents run at the correct times.\n\n## Acceptance Criteria\n- [ ] `calculateNextCronTrigger(expression: string, after?: Date): Date` function in `cron.ts`\n- [ ] Returns next occurrence after the given date (defaults to now)\n- [ ] Uses system timezone (consistent with interval behavior)\n- [ ] Handles edge cases: month boundaries, leap years, DST transitions\n- [ ] Unit tests for: same-day future trigger, next-day rollover, month/year boundary crossing, specific day-of-week calculations\n\n## Test Cases to Implement\n```typescript\n// Daily at 9:00 AM\nconst expr = \"0 9 * * *\";\nconst morning = new Date(\"2024-01-15T08:00:00\");\ncalculateNextCronTrigger(expr, morning)  // â†’ 2024-01-15T09:00:00\n\nconst afterRun = new Date(\"2024-01-15T09:00:00\");\ncalculateNextCronTrigger(expr, afterRun)  // â†’ 2024-01-16T09:00:00\n\n// Every 15 minutes\nconst frequent = \"*/15 * * * *\";\nconst midHour = new Date(\"2024-01-15T10:07:00\");\ncalculateNextCronTrigger(frequent, midHour)  // â†’ 2024-01-15T10:15:00\n```\n\n## Quality Gates\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes with coverage thresholds (85% lines/functions/statements, 65% branches)","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T16:15:26.540358-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T16:24:29.165149-05:00","closed_at":"2026-01-20T16:24:29.165149-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-cay.2","depends_on_id":"herdctl-cay","type":"parent-child","created_at":"2026-01-20T16:15:26.540984-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-cay.2","depends_on_id":"herdctl-cay.1","type":"blocks","created_at":"2026-01-20T16:15:55.206737-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-cay.3","title":"US-4: Validate Cron Expressions with Error Handling","description":"As a user writing config, I want clear error messages for invalid cron expressions so that I can fix configuration mistakes.\n\n## Acceptance Criteria\n- [ ] `CronParseError` class in `packages/core/src/scheduler/errors.ts` extending `FleetManagerError`\n- [ ] `isValidCronExpression(expression: string): boolean` helper function\n- [ ] Error messages include what's wrong and a valid example\n- [ ] Unit tests for error message content\n\n## Example Errors to Test\n```\nCronParseError: Invalid cron expression \"0 25 * * *\" - hour must be 0-23\n  Example valid expression: \"0 9 * * *\" (daily at 9:00 AM)\n\nCronParseError: Invalid cron expression \"* * *\" - expected 5 fields, got 3\n  Example valid expression: \"* * * * *\" (every minute)\n\nCronParseError: Invalid cron expression \"0 9 * * 8\" - day-of-week must be 0-7\n  Example valid expression: \"0 9 * * 1-5\" (weekdays at 9:00 AM)\n```\n\n## Quality Gates\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes with coverage thresholds (85% lines/functions/statements, 65% branches)","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T16:15:32.728834-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T16:28:52.31386-05:00","closed_at":"2026-01-20T16:28:52.31386-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-cay.3","depends_on_id":"herdctl-cay","type":"parent-child","created_at":"2026-01-20T16:15:32.729418-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-cay.3","depends_on_id":"herdctl-cay.1","type":"blocks","created_at":"2026-01-20T16:15:59.718798-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-cay.4","title":"US-3: Integrate Cron into Scheduler","description":"As a scheduler, I want to handle both interval and cron schedules so that users can choose the scheduling method that fits their needs.\n\n## Acceptance Criteria\n- [ ] Update `schedule-runner.ts` to check `schedule.type`\n- [ ] Route to `calculateNextCronTrigger()` when `type === \"cron\"`\n- [ ] Route to existing `calculateNextTrigger()` when `type === \"interval\"`\n- [ ] Update `ScheduleSkipReason` type in `types.ts`: replace `\"not_interval\"` with `\"unsupported_type\"`\n- [ ] Skip `webhook` and `chat` types with `\"unsupported_type\"` reason\n- [ ] No catch-up for missed cron triggers - skip to next scheduled time\n- [ ] Validation at config load time (fail fast)\n- [ ] Additional validation when scheduler starts (defense in depth)\n- [ ] Integration test: cron schedule triggers at correct time\n\n## Behavior on Missed Schedule\nIf the system was down when a cron trigger should have fired, the scheduler calculates the next future occurrence from the current time, not from the missed time.\n\n## Quality Gates\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes with coverage thresholds (85% lines/functions/statements, 65% branches)","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T16:15:41.154036-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T16:45:00.85159-05:00","closed_at":"2026-01-20T16:45:00.85159-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-cay.4","depends_on_id":"herdctl-cay","type":"parent-child","created_at":"2026-01-20T16:15:41.154603-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-cay.4","depends_on_id":"herdctl-cay.2","type":"blocks","created_at":"2026-01-20T16:16:03.880267-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-cay.4","depends_on_id":"herdctl-cay.3","type":"blocks","created_at":"2026-01-20T16:16:08.047953-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-cay.5","title":"US-5: Update Documentation","description":"As a user learning herdctl, I want documentation on cron scheduling so that I understand how to configure time-based triggers.\n\n## Acceptance Criteria\n- [ ] Update `docs/src/content/docs/configuration/agent-config.mdx`\n- [ ] Add cron schedule examples with table of common expressions\n- [ ] Explain cron vs interval use cases\n- [ ] Document supported cron shorthands (`@hourly`, `@daily`, `@weekly`, `@monthly`, `@yearly`)\n\n## Documentation Content to Add\n```markdown\n### Cron Schedules\n\nUse cron expressions for precise time-based scheduling:\n\n| Expression | Description |\n|------------|-------------|\n| `0 9 * * *` | Daily at 9:00 AM |\n| `30 9 * * 1-5` | Weekdays at 9:30 AM |\n| `0 */2 * * *` | Every 2 hours |\n| `0 0 1 * *` | First day of each month |\n\nSupported shorthands: `@hourly`, `@daily`, `@weekly`, `@monthly`, `@yearly`\n\n**When to use cron vs interval:**\n- **Cron**: Specific times matter (daily reports, business hours)\n- **Interval**: Regular frequency matters (health checks, polling)\n```\n\n## Quality Gates\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] Documentation builds successfully (`pnpm build` in docs/)","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T16:15:49.319225-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T16:46:44.945239-05:00","closed_at":"2026-01-20T16:46:44.945239-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-cay.5","depends_on_id":"herdctl-cay","type":"parent-child","created_at":"2026-01-20T16:15:49.31983-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-cay.5","depends_on_id":"herdctl-cay.4","type":"blocks","created_at":"2026-01-20T16:16:12.362307-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-d8f","title":"Phase 2: FleetManager Integration","description":"Wire DiscordManager into FleetManager lifecycle.\n\n## Files to Modify\n- packages/core/src/fleet-manager/fleet-manager.ts\n\n## Implementation Details\n\n### FleetManager Changes\n1. Import DiscordManager\n2. Add private discordManager property\n3. In constructor, create DiscordManager with context:\n   ```typescript\n   this.discordManager = new DiscordManager({\n     config: this.config,\n     jobExecutor: this.jobExecutor,\n     stateManager: this.stateManager,\n     eventBus: this.eventBus,\n   });\n   ```\n4. In start() method, call `await this.discordManager.start()`\n5. In stop() method, call `await this.discordManager.stop()`\n\n### Event Emissions\n- Emit `discord:connector:connected` when a connector successfully connects\n- Emit `discord:connector:disconnected` when a connector disconnects\n- Emit `discord:connector:error` when a connector has an error\n\n### Status Integration\n- Add Discord connector status to agent status queries\n- Include connection state (connected/disconnected/error) in status\n\n## Acceptance Criteria\n- [ ] FleetManager creates DiscordManager during construction\n- [ ] FleetManager.start() calls discordManager.start()\n- [ ] FleetManager.stop() calls discordManager.stop()\n- [ ] Events emitted for connector state changes\n- [ ] Agent status includes Discord connection state\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T21:59:45.610537-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:14:15.772038-05:00","closed_at":"2026-01-26T22:14:15.772038-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-d8f","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T21:59:49.072929-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-d8f","depends_on_id":"herdctl-5fg","type":"blocks","created_at":"2026-01-26T21:59:49.154158-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz","title":"herdctl CLI","description":"Command-line interface for fleet management. A thin CLI wrapper around FleetManager that provides intuitive commands for all fleet operations.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:07.1016-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T15:07:23.433552-05:00","closed_at":"2026-01-20T15:07:23.433552-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-herdctl-cli.md","labels":["feature","ralph"]}
{"id":"herdctl-giz.1","title":"US-9: Changesets \u0026 npm Publishing Setup","description":"As a maintainer of herdctl, I want automated versioning and npm publishing via changesets so that releases are automated and consistent on merge to main.\n\n## Acceptance Criteria\n- [ ] Changesets initialized in monorepo root\n- [ ] `.changeset/config.json` configured for public access\n- [ ] `packages/cli/package.json` configured for npm publishing\n- [ ] `packages/core/package.json` `private: false` and configured for publishing\n- [ ] `.github/workflows/release.yml` created with OIDC publishing\n- [ ] Root `package.json` has `changeset`, `version`, `release` scripts\n- [ ] `pnpm changeset` creates changeset files correctly\n- [ ] GitHub Action creates \"Version Packages\" PR on merge\n- [ ] Packages publish with provenance attestations\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:12.360136-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T13:51:38.923624-05:00","closed_at":"2026-01-20T13:51:38.923624-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.1","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:12.360768-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.2","title":"US-6: Initialize Project (herdctl init)","description":"As a new user, I want `herdctl init` to scaffold a new project so that I can get started quickly.\n\n## Commands\n```bash\nherdctl init                    # Interactive setup\nherdctl init --name my-fleet    # With fleet name\nherdctl init --example simple   # From example template\nherdctl init --yes              # Accept all defaults\n```\n\n## Acceptance Criteria\n- [ ] Interactive prompts for fleet name if not provided\n- [ ] Creates `herdctl.yaml` with sensible defaults\n- [ ] Creates `agents/` directory with example agent\n- [ ] Creates `.herdctl/` directory (adds to .gitignore if exists)\n- [ ] Shows next steps after creation\n- [ ] `--example` pulls from built-in templates\n- [ ] Errors if config already exists (use `--force` to overwrite)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:19.47923-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T13:56:36.133799-05:00","closed_at":"2026-01-20T13:56:36.133799-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.2","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:19.479837-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.2","depends_on_id":"herdctl-giz.1","type":"blocks","created_at":"2026-01-20T13:47:18.916774-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.3","title":"US-7: Validate Config (herdctl config)","description":"As a user editing configuration, I want `herdctl config validate` to check my config so that I can catch errors before running.\n\n## Commands\n```bash\nherdctl config validate         # Validate current config\nherdctl config validate --fix   # Show suggestions for fixes\nherdctl config show             # Show merged/resolved config\nherdctl config show --json      # JSON output\n```\n\n## Acceptance Criteria\n- [ ] Validates against Zod schemas from @herdctl/core\n- [ ] Shows all validation errors, not just first\n- [ ] `--fix` suggests corrections where possible\n- [ ] `show` displays fully resolved config (env vars expanded, defaults applied)\n- [ ] Exit code 0 if valid, 1 if invalid\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:26.060459-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:02:13.459894-05:00","closed_at":"2026-01-20T14:02:13.459894-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.3","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:26.061051-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.3","depends_on_id":"herdctl-giz.2","type":"blocks","created_at":"2026-01-20T13:47:18.989064-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.4","title":"US-1: Start Fleet (herdctl start)","description":"As a user running herdctl, I want `herdctl start` to start the fleet so that my agents begin running their schedules.\n\n## Commands\n```bash\nherdctl start                              # Start all agents\nherdctl start --config ./path/to/config    # Custom config path\nherdctl start --state ./path/to/state      # Custom state directory\n```\n\n## Acceptance Criteria\n- [ ] Parses `--config` and `--state` arguments\n- [ ] Creates FleetManager with provided paths (or defaults)\n- [ ] Calls `fleet.initialize()` then `fleet.start()`\n- [ ] Keeps process running (fleet runs scheduler loop)\n- [ ] Streams logs to stdout using `fleet.streamLogs()`\n- [ ] Writes PID to `.herdctl/herdctl.pid` for stop command\n- [ ] Handles SIGINT/SIGTERM for graceful shutdown\n- [ ] Shows startup message with fleet status summary\n- [ ] Exits with code 0 on graceful shutdown, 1 on error\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:33.397957-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:08:54.250581-05:00","closed_at":"2026-01-20T14:08:54.250581-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.4","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:33.398508-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.4","depends_on_id":"herdctl-giz.3","type":"blocks","created_at":"2026-01-20T13:47:19.066065-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.5","title":"US-2: Stop Fleet (herdctl stop)","description":"As a user with a running fleet, I want `herdctl stop` to gracefully stop the fleet so that running jobs complete before shutdown.\n\n## Commands\n```bash\nherdctl stop               # Graceful stop (wait for jobs)\nherdctl stop --force       # Immediate stop (cancel jobs)\nherdctl stop --timeout 30  # Wait max 30 seconds\n```\n\n## Acceptance Criteria\n- [ ] Reads PID from `.herdctl/herdctl.pid`\n- [ ] Sends SIGTERM to fleet process (graceful)\n- [ ] With `--force`, sends SIGKILL\n- [ ] With `--timeout`, waits specified seconds before force kill\n- [ ] Default timeout: 30 seconds\n- [ ] Shows \"Fleet stopped\" message on success\n- [ ] Removes PID file after successful stop\n- [ ] Errors if no PID file found or process not running\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:40.038651-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:12:16.727058-05:00","closed_at":"2026-01-20T14:12:16.727058-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.5","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:40.039238-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.5","depends_on_id":"herdctl-giz.4","type":"blocks","created_at":"2026-01-20T13:47:19.139669-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.6","title":"US-3: Fleet Status (herdctl status)","description":"As a user monitoring my fleet, I want `herdctl status` to show fleet and agent status so that I can see what's running and what's scheduled.\n\n## Commands\n```bash\nherdctl status             # Overview of all agents\nherdctl status \u003cagent\u003e     # Detailed status of specific agent\nherdctl status --json      # JSON output for scripting\n```\n\n## Acceptance Criteria\n- [ ] Calls `fleet.getStatus()` and `fleet.getAgentInfo()`\n- [ ] Default output shows formatted table\n- [ ] `--json` outputs structured JSON with error codes\n- [ ] Agent detail view shows schedules and recent jobs\n- [ ] Relative times shown (e.g., \"in 45m\", \"5m ago\")\n- [ ] Colors indicate status (green=running, yellow=idle, red=error)\n- [ ] Respects NO_COLOR environment variable\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:46.73759-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:16:17.550073-05:00","closed_at":"2026-01-20T14:16:17.550073-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.6","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:46.738177-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.6","depends_on_id":"herdctl-giz.4","type":"blocks","created_at":"2026-01-20T13:47:19.214957-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.7","title":"US-4: View Logs (herdctl logs)","description":"As a user debugging agent behavior, I want `herdctl logs` to show agent output so that I can see what agents are doing.\n\n## Commands\n```bash\nherdctl logs               # Recent logs from all agents\nherdctl logs \u003cagent\u003e       # Logs from specific agent\nherdctl logs -f            # Follow mode (stream new logs)\nherdctl logs -f \u003cagent\u003e    # Follow specific agent\nherdctl logs --job \u003cid\u003e    # Logs from specific job\nherdctl logs -n 100        # Last 100 lines (default: 50)\nherdctl logs --json        # JSON output for each log entry\n```\n\n## Acceptance Criteria\n- [ ] Uses `fleet.streamLogs()`, `fleet.streamAgentLogs()`, `fleet.streamJobOutput()`\n- [ ] Default shows last 50 log entries\n- [ ] `-f` streams continuously until Ctrl+C\n- [ ] `--job` filters to specific job ID\n- [ ] Timestamps in local timezone\n- [ ] Color-coded by log type (assistant, tool, result, error)\n- [ ] `--json` outputs newline-delimited JSON\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:46:54.549216-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:18:57.926262-05:00","closed_at":"2026-01-20T14:18:57.926262-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.7","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:46:54.549807-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.7","depends_on_id":"herdctl-giz.6","type":"blocks","created_at":"2026-01-20T13:47:19.289527-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.8","title":"US-5: Trigger Agent (herdctl trigger)","description":"As a user wanting to run an agent immediately, I want `herdctl trigger \u003cagent\u003e` to start a job so that I don't have to wait for the schedule.\n\n## Commands\n```bash\nherdctl trigger \u003cagent\u003e                    # Trigger default schedule\nherdctl trigger \u003cagent\u003e --schedule \u003cname\u003e  # Trigger specific schedule\nherdctl trigger \u003cagent\u003e --prompt \"...\"     # Custom prompt\nherdctl trigger \u003cagent\u003e --wait             # Wait for job to complete\nherdctl trigger \u003cagent\u003e --json             # JSON output\n```\n\n## Acceptance Criteria\n- [ ] Calls `fleet.trigger(agentName, scheduleName?, options?)`\n- [ ] Shows job ID immediately\n- [ ] `--wait` streams job output until completion\n- [ ] `--prompt` overrides schedule prompt\n- [ ] Exits with job's exit code when using `--wait`\n- [ ] `--json` outputs structured job info\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:47:01.307121-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:28:55.959667-05:00","closed_at":"2026-01-20T14:28:55.959667-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.8","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:47:01.30774-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.8","depends_on_id":"herdctl-giz.7","type":"blocks","created_at":"2026-01-20T13:47:19.365883-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-giz.9","title":"US-8: Job Management (herdctl jobs/job/cancel)","description":"As a user managing jobs, I want commands to view and control jobs so that I can monitor and intervene when needed.\n\n## Commands\n```bash\nherdctl jobs                    # List recent jobs (last 20)\nherdctl jobs --agent \u003cname\u003e     # Jobs for specific agent\nherdctl jobs --status running   # Filter by status\nherdctl jobs --limit 50         # Custom limit\nherdctl jobs --json             # JSON output\n\nherdctl job \u003cid\u003e                # Show job details\nherdctl job \u003cid\u003e --logs         # Show job output\nherdctl job \u003cid\u003e --json         # JSON output\n\nherdctl cancel \u003cid\u003e             # Cancel running job\nherdctl cancel \u003cid\u003e --force     # Force cancel (SIGKILL)\n```\n\n## Acceptance Criteria\n- [ ] `jobs` lists recent jobs with status, agent, duration\n- [ ] Filters: `--agent`, `--status` (pending, running, completed, failed, cancelled)\n- [ ] `job \u003cid\u003e` shows detailed job info including config used\n- [ ] `job \u003cid\u003e --logs` streams job output\n- [ ] `cancel` calls `fleet.cancelJob(jobId)`\n- [ ] Confirmation prompt before cancel (unless `--yes`)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T13:47:09.601478-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T14:36:08.324474-05:00","closed_at":"2026-01-20T14:36:08.324474-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-giz.9","depends_on_id":"herdctl-giz","type":"parent-child","created_at":"2026-01-20T13:47:09.602079-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-giz.9","depends_on_id":"herdctl-giz.8","type":"blocks","created_at":"2026-01-20T13:47:19.440562-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-hqw","title":"Execution Hooks System","description":"Add a config-driven execution hooks system to herdctl that enables running arbitrary code at agent lifecycle points. This provides a generic, extensible foundation for notifications, logging, integrations, and custom automation.\n\n## Quality Gates\n- pnpm typecheck passes\n- pnpm test passes  \n- pnpm build succeeds","status":"closed","priority":2,"issue_type":"epic","assignee":"ed@edspencer.net","owner":"ed@edspencer.net","created_at":"2026-01-26T13:48:50.842373-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:04:10.589169-05:00","closed_at":"2026-01-26T22:04:10.589169-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-execution-hooks-system.md","labels":["feature","ralph"]}
{"id":"herdctl-hqw.1","title":"US1: Shell Script Hook","description":"As a fleet operator, I want to run a custom shell script after each job completes so that I can integrate with my existing tooling and workflows.\n\n## Acceptance Criteria\n- Can configure a shell command to run after job completion\n- Script receives job context via JSON on stdin\n- Script exit code is logged but doesn't fail the job (by default)\n- Can configure `continue_on_error: false` to fail on hook errors\n\n## Technical Notes\n- Implement ShellHookRunner in packages/core/src/hooks/runners/shell.ts\n- Spawns shell process, pipes HookContext JSON to stdin\n- Logs stdout/stderr, checks exit code (0 = success)\n- Default timeout: 30000ms\n\n## Quality Gates\n- pnpm typecheck passes\n- pnpm test passes\n- pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","assignee":"ed@edspencer.net","owner":"ed@edspencer.net","created_at":"2026-01-26T13:48:59.927147-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T14:04:52.706853-05:00","closed_at":"2026-01-26T14:04:52.706853-05:00","close_reason":"Completed by agent","labels":["feature","ralph"],"dependencies":[{"issue_id":"herdctl-hqw.1","depends_on_id":"herdctl-hqw","type":"parent-child","created_at":"2026-01-26T13:48:59.927974-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-hqw.2","title":"US2: Webhook Hook","description":"As a fleet operator, I want to POST job results to a webhook URL so that I can integrate with external services (monitoring, ticketing, custom dashboards).\n\n## Acceptance Criteria\n- Can configure a webhook URL to receive POST requests\n- Webhook receives JSON payload with job context\n- Supports custom headers (for auth tokens)\n- HTTP errors are logged but don't fail the job (by default)\n\n## Technical Notes\n- Implement WebhookHookRunner in packages/core/src/hooks/runners/webhook.ts\n- HTTP POST/PUT with JSON body (HookContext)\n- Content-Type: application/json\n- 2xx = success, anything else = failure\n- Supports ${ENV_VAR} substitution in headers\n- Default timeout: 10000ms\n\n## Quality Gates\n- pnpm typecheck passes\n- pnpm test passes\n- pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","assignee":"ed@edspencer.net","owner":"ed@edspencer.net","created_at":"2026-01-26T13:49:06.085556-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T14:09:01.516345-05:00","closed_at":"2026-01-26T14:09:01.516345-05:00","close_reason":"Completed by agent","labels":["feature","ralph"],"dependencies":[{"issue_id":"herdctl-hqw.2","depends_on_id":"herdctl-hqw","type":"parent-child","created_at":"2026-01-26T13:49:06.087837-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-hqw.3","title":"US3: Discord Notification Hook","description":"As a fleet operator, I want job results posted to a Discord channel so that my team has visibility into fleet activity without watching logs.\n\n## Acceptance Criteria\n- Can configure Discord channel ID and bot token\n- Messages use Discord embeds with appropriate colors (green=success, red=failed)\n- Can filter which events trigger notifications (`on_events: [completed, failed]`)\n- Bot token is read from environment variable (not hardcoded in config)\n\n## Technical Notes\n- Implement DiscordHookRunner in packages/core/src/hooks/runners/discord.ts\n- Reads bot token from specified env var (bot_token_env)\n- Creates Discord embed message\n- Posts via Discord API\n- Embed color: green (#22c55e) for success, red (#ef4444) for failure\n- Truncate output to max 1000 chars in embed\n\n## Quality Gates\n- pnpm typecheck passes\n- pnpm test passes\n- pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","assignee":"ed@edspencer.net","owner":"ed@edspencer.net","created_at":"2026-01-26T13:49:14.00578-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T14:14:38.160529-05:00","closed_at":"2026-01-26T14:14:38.160529-05:00","close_reason":"Completed by agent","labels":["feature","ralph"],"dependencies":[{"issue_id":"herdctl-hqw.3","depends_on_id":"herdctl-hqw","type":"parent-child","created_at":"2026-01-26T13:49:14.006366-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-hqw.4","title":"US4: Multiple Hooks","description":"As a fleet operator, I want to configure multiple hooks that run sequentially so that I can notify multiple channels and run custom logic.\n\n## Acceptance Criteria\n- Can configure multiple hooks in `after_run` array\n- Hooks execute sequentially in order defined\n- Each hook's success/failure is logged independently\n- Failed hooks don't block subsequent hooks (when `continue_on_error: true`)\n\n## Technical Notes\n- Implement HookExecutor in packages/core/src/hooks/hook-executor.ts\n- Orchestrates hook execution, handles sequencing\n- Calls appropriate runner for each hook type (shell, webhook, discord)\n- Logs each hook's result independently\n- Respects continue_on_error setting per hook\n\n## Quality Gates\n- pnpm typecheck passes\n- pnpm test passes\n- pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","assignee":"ed@edspencer.net","owner":"ed@edspencer.net","created_at":"2026-01-26T13:49:20.62451-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T14:16:41.851772-05:00","closed_at":"2026-01-26T14:16:41.851772-05:00","close_reason":"Completed by agent","labels":["feature","ralph"],"dependencies":[{"issue_id":"herdctl-hqw.4","depends_on_id":"herdctl-hqw","type":"parent-child","created_at":"2026-01-26T13:49:20.625125-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-hqw.4","depends_on_id":"herdctl-hqw.1","type":"blocks","created_at":"2026-01-26T13:49:36.920461-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-hqw.4","depends_on_id":"herdctl-hqw.2","type":"blocks","created_at":"2026-01-26T13:49:36.998816-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-hqw.4","depends_on_id":"herdctl-hqw.3","type":"blocks","created_at":"2026-01-26T13:49:37.075821-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-hqw.5","title":"US5: Error-Specific Hooks","description":"As a fleet operator, I want to run different hooks for errors vs. success so that I can escalate failures to on-call while sending routine completions to a general channel.\n\n## Acceptance Criteria\n- Can configure `on_error` hooks separately from `after_run`\n- `on_error` hooks only run when job fails\n- `after_run` hooks run regardless of success/failure (can filter with `on_events`)\n\n## Technical Notes\n- Extend HookExecutor to handle on_error vs after_run\n- Wire into job completion flow in FleetManager\n- on_error hooks triggered only on failure events\n- after_run hooks always triggered (subject to on_events filter)\n\n## Quality Gates\n- pnpm typecheck passes\n- pnpm test passes\n- pnpm build succeeds","status":"closed","priority":2,"issue_type":"task","assignee":"ed@edspencer.net","owner":"ed@edspencer.net","created_at":"2026-01-26T13:49:31.660336-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T14:19:47.037984-05:00","closed_at":"2026-01-26T14:19:47.037984-05:00","close_reason":"Completed by agent","labels":["feature","ralph"],"dependencies":[{"issue_id":"herdctl-hqw.5","depends_on_id":"herdctl-hqw","type":"parent-child","created_at":"2026-01-26T13:49:31.661034-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-hqw.5","depends_on_id":"herdctl-hqw.4","type":"blocks","created_at":"2026-01-26T13:49:37.148759-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-i6w","title":"Library Documentation for @herdctl/core","description":"Comprehensive documentation for using @herdctl/core as a standalone TypeScript library. Enables developers to programmatically manage fleets of autonomous Claude Code agents without going through the CLI.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-20T09:28:46.655603-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T15:07:23.514063-05:00","closed_at":"2026-01-20T15:07:23.514063-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-herdctl-library-docs.md","labels":["feature","ralph"]}
{"id":"herdctl-i6w.1","title":"US-1: Installation \u0026 Getting Started","description":"As a developer who wants to use herdctl programmatically, I want clear installation instructions and a quick start guide so that I can get a basic fleet running in under 5 minutes.\n\n## Acceptance Criteria\n- [ ] npm/pnpm installation commands documented\n- [ ] Minimum viable code example (\u003c 20 lines) that compiles and runs\n- [ ] Required files/directories explained (config, state directory)\n- [ ] First successful run produces visible output confirming it works\n- [ ] Code example extracted from actual test file\n\n## Quality Gates\n- [ ] All code examples compile with `tsc --noEmit`\n- [ ] Example files run without errors\n- [ ] Documentation builds successfully (`pnpm build` in docs/)\n- [ ] All internal cross-references resolve","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T09:28:51.862413-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:39:22.799186-05:00","closed_at":"2026-01-20T09:39:22.799186-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-i6w.1","depends_on_id":"herdctl-i6w","type":"parent-child","created_at":"2026-01-20T09:28:51.863032-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-i6w.2","title":"US-2: FleetManager API Reference","description":"As a developer integrating herdctl into my application, I want complete API documentation with type signatures so that I understand all available methods and their parameters.\n\n## Acceptance Criteria\n- [ ] Constructor options documented with descriptions and defaults\n- [ ] Each lifecycle method (`initialize`, `start`, `stop`, `reload`) has:\n  - Method signature\n  - Description\n  - Parameters table (name, type, required, description)\n  - Return type\n  - One working code example\n- [ ] Each query method (`getStatus`, `getAgents`, `getAgent`, `getSchedules`) documented same way\n- [ ] Each action method (`trigger`, `cancelJob`, `forkJob`) documented same way\n- [ ] All type definitions included or linked\n- [ ] Examples extracted from test files\n\n## Quality Gates\n- [ ] All code examples compile with `tsc --noEmit`\n- [ ] Example files run without errors\n- [ ] Type signatures match actual implementation\n- [ ] Documentation builds successfully (`pnpm build` in docs/)\n- [ ] All internal cross-references resolve","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T09:28:58.34361-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:46:28.892154-05:00","closed_at":"2026-01-20T09:46:28.892154-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-i6w.2","depends_on_id":"herdctl-i6w","type":"parent-child","created_at":"2026-01-20T09:28:58.34419-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.2","depends_on_id":"herdctl-i6w.1","type":"blocks","created_at":"2026-01-20T09:29:32.916785-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-i6w.3","title":"US-3: Event Handling Guide","description":"As a developer building a UI or monitoring system, I want to understand the event system and payloads so that I can react to fleet state changes in real-time.\n\n## Acceptance Criteria\n- [ ] Complete list of events with payload type signatures\n- [ ] Example: subscribing to multiple events\n- [ ] Example: building a simple progress monitor (console-based)\n- [ ] Example: streaming job output to terminal with colors\n- [ ] TypeScript type-safe event handling patterns shown\n- [ ] Guidance on when to use events vs polling\n\n## Quality Gates\n- [ ] All code examples compile with `tsc --noEmit`\n- [ ] Example files run without errors\n- [ ] Type signatures match actual implementation\n- [ ] Documentation builds successfully (`pnpm build` in docs/)\n- [ ] All internal cross-references resolve","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T09:29:04.84346-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:52:44.891546-05:00","closed_at":"2026-01-20T09:52:44.891546-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-i6w.3","depends_on_id":"herdctl-i6w","type":"parent-child","created_at":"2026-01-20T09:29:04.844024-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.3","depends_on_id":"herdctl-i6w.2","type":"blocks","created_at":"2026-01-20T09:29:32.990894-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-i6w.4","title":"US-4: Error Handling Guide","description":"As a developer building a robust integration, I want to understand error types and recovery patterns so that my application handles failures gracefully.\n\n## Acceptance Criteria\n- [ ] Error class hierarchy documented (text or simple diagram)\n- [ ] Each error class has description and common causes\n- [ ] Type guards documented with examples\n- [ ] Common error scenarios with recommended handling\n- [ ] Retry patterns for transient failures\n- [ ] Graceful degradation patterns\n\n## Quality Gates\n- [ ] All code examples compile with `tsc --noEmit`\n- [ ] Example files run without errors\n- [ ] Type signatures match actual implementation\n- [ ] Documentation builds successfully (`pnpm build` in docs/)\n- [ ] All internal cross-references resolve","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T09:29:10.292128-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:59:28.242956-05:00","closed_at":"2026-01-20T09:59:28.242956-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-i6w.4","depends_on_id":"herdctl-i6w","type":"parent-child","created_at":"2026-01-20T09:29:10.292725-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.4","depends_on_id":"herdctl-i6w.2","type":"blocks","created_at":"2026-01-20T09:29:33.06244-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-i6w.5","title":"US-5: JobManager Documentation","description":"As a developer who needs to query job history or stream output, I want documentation for the JobManager API so that I can build job monitoring and log viewing features.\n\n## Acceptance Criteria\n- [ ] JobManager instantiation (standalone and via FleetManager)\n- [ ] `getJob()` documented with example\n- [ ] `listJobs()` with filter options documented\n- [ ] `streamOutput()` async iterator pattern documented\n- [ ] Example: building a job history viewer\n- [ ] Example: tailing job output in real-time\n\n## Quality Gates\n- [ ] All code examples compile with `tsc --noEmit`\n- [ ] Example files run without errors\n- [ ] Type signatures match actual implementation\n- [ ] Documentation builds successfully (`pnpm build` in docs/)\n- [ ] All internal cross-references resolve","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T09:29:17.200752-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T10:07:37.082323-05:00","closed_at":"2026-01-20T10:07:37.082323-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-i6w.5","depends_on_id":"herdctl-i6w","type":"parent-child","created_at":"2026-01-20T09:29:17.20133-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.5","depends_on_id":"herdctl-i6w.2","type":"blocks","created_at":"2026-01-20T09:29:33.136104-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-i6w.6","title":"US-6: Common Recipes \u0026 Patterns","description":"As a developer with specific use cases, I want code examples for common scenarios so that I can copy/paste and adapt for my needs.\n\n## Acceptance Criteria\n- [ ] Recipe: Simple one-shot agent execution\n- [ ] Recipe: Long-running daemon with graceful shutdown (SIGINT/SIGTERM)\n- [ ] Recipe: Building a simple CLI wrapper\n- [ ] Recipe: Building a simple web dashboard (Express)\n- [ ] Recipe: Integrating with existing Fastify server\n- [ ] Recipe: Running in CI/CD pipeline (GitHub Actions example)\n- [ ] Recipe: Hot-reloading configuration changes\n- [ ] Recipe: TypeScript project setup from scratch\n- [ ] Recipe: Monorepo integration patterns\n- [ ] Recipe: Testing patterns (unit testing with mocks)\n- [ ] All recipes compile and run\n\n## Quality Gates\n- [ ] All code examples compile with `tsc --noEmit`\n- [ ] Example files run without errors\n- [ ] Documentation builds successfully (`pnpm build` in docs/)\n- [ ] Sidebar shows all pages correctly","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T09:29:24.681947-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T10:17:46.394912-05:00","closed_at":"2026-01-20T10:17:46.394912-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-i6w.6","depends_on_id":"herdctl-i6w","type":"parent-child","created_at":"2026-01-20T09:29:24.682515-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.6","depends_on_id":"herdctl-i6w.3","type":"blocks","created_at":"2026-01-20T09:29:33.21738-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.6","depends_on_id":"herdctl-i6w.4","type":"blocks","created_at":"2026-01-20T09:29:33.295444-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-i6w.6","depends_on_id":"herdctl-i6w.5","type":"blocks","created_at":"2026-01-20T09:29:33.373162-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-j1g","title":"Phase 7: Changesets \u0026 Final Validation","description":"Create changesets and perform final validation before merge.\n\n## Changeset Creation\nPer project conventions, create changesets:\n\n```bash\npnpm changeset\n```\n\nSelect:\n- @herdctl/core - **minor** (new DiscordManager module, new public API)\n- @herdctl/discord - **patch** (if any fixes made during integration)\n\n### Changeset Description Examples\n\nFor @herdctl/core:\n```\nAdd Discord chat integration via DiscordManager module\n\n- DiscordManager manages lifecycle of Discord connectors per agent\n- Messages routed to JobExecutor for Claude execution\n- Responses delivered back to Discord channels\n- Session persistence across restarts\n```\n\nFor @herdctl/discord (if needed):\n```\nFix session persistence edge cases discovered during FleetManager integration\n```\n\n## Final Validation Checklist\n\n### Build \u0026 Test\n- [ ] pnpm install (clean install)\n- [ ] pnpm build (all packages)\n- [ ] pnpm typecheck (no errors)\n- [ ] pnpm test (all pass, 85% coverage)\n\n### Manual Testing\n- [ ] Configure example agent with Discord\n- [ ] Run herdctl start\n- [ ] Verify bot comes online in Discord\n- [ ] Send @mention message\n- [ ] Verify response received\n- [ ] Run /reset command\n- [ ] Verify session cleared\n- [ ] Run herdctl stop\n- [ ] Verify bot goes offline gracefully\n\n### Code Quality\n- [ ] No console.log statements left\n- [ ] Error messages are actionable\n- [ ] Code follows existing patterns\n- [ ] No unused imports or variables\n\n## Acceptance Criteria\n- [ ] Changesets created for modified packages\n- [ ] All validation checks pass\n- [ ] Manual testing successful\n- [ ] PR ready for review","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T22:00:52.612818-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:37:46.374435-05:00","closed_at":"2026-01-26T22:37:46.374435-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-j1g","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T22:00:55.851956-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-j1g","depends_on_id":"herdctl-4ji","type":"blocks","created_at":"2026-01-26T22:00:55.928053-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x","title":"Scheduler (Interval-Based MVP)","description":"Implement the interval-based scheduler for herdctl in packages/core/src/scheduler/. This module orchestrates agent execution by monitoring schedule configurations, tracking schedule state, and triggering jobs when intervals elapse. Key design: interval timers start after job completion, not when the job starts.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-19T22:30:39.842026-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T07:16:01.778763-05:00","closed_at":"2026-01-20T07:16:01.778763-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-prd-6-scheduler-interval-based-mvp.md","labels":["feature","ralph"]}
{"id":"herdctl-m6x.1","title":"US-1: Parse Interval Strings","description":"As a fleet operator, I want to specify intervals in human-readable format like \"5m\", \"1h\", \"30s\" so that I don't have to calculate milliseconds manually.\n\n## Acceptance Criteria\n- [ ] Parse `{number}{unit}` format where unit is s/m/h/d\n- [ ] `5s` â†’ 5000ms, `5m` â†’ 300000ms, `1h` â†’ 3600000ms, `1d` â†’ 86400000ms\n- [ ] Support integer values only (no \"1.5h\")\n- [ ] Throw descriptive `SchedulerError` for invalid formats\n- [ ] Handle edge cases: empty string, missing unit, invalid unit, negative numbers\n- [ ] Export `parseInterval(interval: string): number` function\n- [ ] Create packages/core/src/scheduler/interval.ts\n- [ ] Create packages/core/src/scheduler/errors.ts with IntervalParseError\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:30:47.600572-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:35:33.665918-05:00","closed_at":"2026-01-19T22:35:33.665918-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.1","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:30:47.6011-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.2","title":"US-2: Track Schedule State","description":"As a scheduler, I want to persist last_run_at and next_run_at per agent/schedule so that schedules survive restarts and can be monitored.\n\n## Acceptance Criteria\n- [ ] Store schedule state in existing fleet state (`.herdctl/state.yaml`)\n- [ ] Extend `AgentState` with optional `schedules` map containing: last_run_at, next_run_at, status ('idle'|'running'|'disabled'), last_error\n- [ ] Provide `getScheduleState(stateDir, agentName, scheduleName)` function\n- [ ] Provide `updateScheduleState(stateDir, agentName, scheduleName, updates)` function\n- [ ] Provide `getAgentScheduleStates(stateDir, agentName)` function\n- [ ] Handle missing schedule state gracefully (return defaults)\n- [ ] Create packages/core/src/scheduler/schedule-state.ts\n- [ ] Update fleet state schema in packages/core/src/state/schemas/fleet-state.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:30:54.352699-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:39:38.402168-05:00","closed_at":"2026-01-19T22:39:38.402168-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.2","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:30:54.353283-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.2","depends_on_id":"herdctl-m6x.1","type":"blocks","created_at":"2026-01-19T22:31:04.261751-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.3","title":"US-3: Calculate Next Trigger Time","description":"As a scheduler, I want to calculate when each schedule should next trigger so that I can efficiently wake up and trigger jobs.\n\n## Acceptance Criteria\n- [ ] Implement `calculateNextTrigger(lastCompletedAt: Date | null, interval: string, jitterPercent?: number): Date`\n- [ ] If no `lastCompletedAt`, return `now` (trigger immediately on first run)\n- [ ] Next trigger = lastCompletedAt + interval\n- [ ] Handle clock skew gracefully (if next_trigger_at is in the past, trigger now)\n- [ ] Add jitter to prevent thundering herd (configurable 0-10% of interval)\n- [ ] Implement `isScheduleDue(nextRunAt: Date, now?: Date): boolean`\n- [ ] Add to packages/core/src/scheduler/interval.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:31:00.775079-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:41:59.690051-05:00","closed_at":"2026-01-19T22:41:59.690051-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.3","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:31:00.775623-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.3","depends_on_id":"herdctl-m6x.1","type":"blocks","created_at":"2026-01-19T22:31:04.337444-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.4","title":"US-4: Scheduler Loop","description":"As a scheduler, I want to continuously check all schedules and trigger due agents so that agents run according to their configured intervals.\n\n## Acceptance Criteria\n- [ ] Create Scheduler class with `start()` method that begins the polling loop\n- [ ] Check all agents' interval schedules on each iteration\n- [ ] Default check interval: 1 second (configurable via checkInterval option)\n- [ ] Skip non-interval schedule types (cron, webhook, chat reserved for future PRDs)\n- [ ] Skip disabled schedules\n- [ ] Skip agents at max_concurrent capacity\n- [ ] Log when skipping due to capacity or schedule conditions\n- [ ] Efficient: don't spin-wait, use appropriate sleep with AbortController\n- [ ] Track running state with `isRunning()` method\n- [ ] Create packages/core/src/scheduler/scheduler.ts\n- [ ] Create packages/core/src/scheduler/types.ts with SchedulerOptions, SchedulerStatus, ScheduleStatus interfaces\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:31:11.316402-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:46:53.860998-05:00","closed_at":"2026-01-19T22:46:53.860998-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.4","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:31:11.316941-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.4","depends_on_id":"herdctl-m6x.2","type":"blocks","created_at":"2026-01-19T22:31:14.570776-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.4","depends_on_id":"herdctl-m6x.3","type":"blocks","created_at":"2026-01-19T22:31:14.64578-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.5","title":"US-5: Execute Schedule Triggers","description":"As a scheduler, I want to invoke the runner with agent config and prompt when triggered so that scheduled work actually executes.\n\n## Acceptance Criteria\n- [ ] Call `JobExecutor.execute()` when schedule triggers\n- [ ] Pass agent config, prompt from schedule config, and trigger metadata\n- [ ] Set `triggerType: 'interval'` and `schedule: scheduleName` in trigger metadata\n- [ ] Update schedule state to 'running' before execution\n- [ ] Update schedule state with `last_run_at` and calculate `next_run_at` after completion\n- [ ] Handle work_source integration: if schedule has work_source, fetch work item first\n- [ ] Report outcome to work source after execution\n- [ ] Create packages/core/src/scheduler/schedule-runner.ts\n- [ ] Implement `runSchedule(options: RunScheduleOptions): Promise\u003cRunnerResult\u003e`\n- [ ] Implement `buildSchedulePrompt(schedule, workItem?): string`\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:31:22.740732-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:52:13.113374-05:00","closed_at":"2026-01-19T22:52:13.113374-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.5","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:31:22.741273-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.5","depends_on_id":"herdctl-m6x.4","type":"blocks","created_at":"2026-01-19T22:31:27.799396-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.6","title":"US-6: Respect max_concurrent Limit","description":"As a fleet operator, I want to limit concurrent jobs per agent so that resources aren't exhausted and work is manageable.\n\n## Acceptance Criteria\n- [ ] Read `instances.max_concurrent` from agent config (default: 1)\n- [ ] Track running jobs per agent in scheduler state using Map\u003cstring, Set\u003cstring\u003e\u003e\n- [ ] Skip triggering if `runningJobs[agentName] \u003e= max_concurrent`\n- [ ] Decrement running count when job completes (success or failure)\n- [ ] Expose `getRunningJobCount(agentName): number` for monitoring\n- [ ] Integrate concurrency tracking into Scheduler class\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:31:33.585685-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T22:58:01.640387-05:00","closed_at":"2026-01-19T22:58:01.640387-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.6","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:31:33.586284-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.6","depends_on_id":"herdctl-m6x.5","type":"blocks","created_at":"2026-01-19T22:31:36.258635-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.7","title":"US-7: Handle Errors Gracefully","description":"As a scheduler, I want errors in one schedule to not affect other schedules so that the fleet remains operational despite individual failures.\n\n## Acceptance Criteria\n- [ ] Catch and log errors during schedule execution\n- [ ] Update schedule state to include error info (`last_error` field)\n- [ ] Continue processing other schedules after error\n- [ ] Don't mark job as complete if execution failed (let Runner handle job state)\n- [ ] Add ScheduleTriggerError class to errors.ts\n- [ ] Implement error handling in Scheduler check loop\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:31:41.950234-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T23:00:45.334685-05:00","closed_at":"2026-01-19T23:00:45.334685-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.7","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:31:41.950791-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.7","depends_on_id":"herdctl-m6x.6","type":"blocks","created_at":"2026-01-19T22:31:44.921262-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.8","title":"US-8: Graceful Shutdown","description":"As a fleet operator, I want the scheduler to shut down cleanly so that running jobs complete and state is consistent.\n\n## Acceptance Criteria\n- [ ] Implement `Scheduler.stop(options?: StopOptions)` that signals shutdown\n- [ ] Stop starting new triggers immediately when stop() is called\n- [ ] Optionally wait for running jobs to complete (configurable timeout via StopOptions)\n- [ ] Update fleet state on shutdown\n- [ ] Return Promise that resolves when shutdown complete\n- [ ] Add StopOptions interface to types.ts\n- [ ] Add SchedulerShutdownError class to errors.ts\n- [ ] Handle timeout when waiting for jobs (throw SchedulerShutdownError with timedOut=true)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:31:51.207521-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T23:05:37.48688-05:00","closed_at":"2026-01-19T23:05:37.48688-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.8","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:31:51.208061-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.8","depends_on_id":"herdctl-m6x.7","type":"blocks","created_at":"2026-01-19T22:31:54.026976-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-m6x.9","title":"US-9: Update Documentation","description":"As a developer, I want comprehensive documentation for the scheduler so that I understand how to configure and monitor scheduled agents.\n\n## Acceptance Criteria\n- [ ] Add \"Scheduling\" section to docs covering:\n  - Interval configuration syntax and examples\n  - How interval timing works (after completion, not start)\n  - Concurrency control with max_concurrent\n  - Schedule state and monitoring\n  - Integration with work sources\n- [ ] Update existing config documentation to reference scheduling\n- [ ] Add troubleshooting section for common scheduling issues\n- [ ] Create packages/core/src/scheduler/index.ts with all public exports\n- [ ] Ensure documentation site builds successfully (`pnpm build` in docs/)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T22:32:00.829908-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T23:12:14.482057-05:00","closed_at":"2026-01-19T23:12:14.482057-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-m6x.9","depends_on_id":"herdctl-m6x","type":"parent-child","created_at":"2026-01-19T22:32:00.830457-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-m6x.9","depends_on_id":"herdctl-m6x.8","type":"blocks","created_at":"2026-01-19T22:32:03.817133-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-r57","title":"Phase 3: Message Handling Pipeline","description":"Subscribe to DiscordConnector events and route messages to job execution.\n\n## Files to Modify\n- packages/core/src/fleet-manager/discord-manager.ts\n\n## Implementation Details\n\n### Event Subscription\nIn DiscordManager.start(), after connecting each connector:\n```typescript\nconnector.on('message', (event) =\u003e this.handleMessage(agentName, event));\nconnector.on('mention', (event) =\u003e this.handleMention(agentName, event));\nconnector.on('error', (error) =\u003e this.handleError(agentName, error));\n```\n\n### Message Handler\n```typescript\nprivate async handleMessage(agentName: string, event: MessageEvent): Promise\u003cvoid\u003e {\n  // 1. Get or create session for channel\n  // 2. Build job context from message\n  // 3. Show typing indicator\n  // 4. Execute job via JobExecutor\n  // 5. Collect response\n  // 6. Send response to channel\n}\n```\n\n### Job Context Building\nCreate a job context similar to `herdctl trigger`:\n- Use message content as prompt\n- Include session ID for conversation continuity\n- Reference the agent configuration\n\n### Pattern Reference\nLook at packages/cli/src/commands/trigger.ts for how jobs are triggered:\n- manager.trigger() creates and executes a job\n- onMessage callback collects streaming output\n\n## Acceptance Criteria\n- [ ] DiscordManager subscribes to connector message/mention events\n- [ ] Message handler extracts prompt from message content\n- [ ] Job context created with agent config and session\n- [ ] Jobs executed via JobExecutor pattern\n- [ ] Typing indicator shown during processing\n- [ ] Errors caught and logged (not crashing the connector)\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T21:59:59.247878-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:19:40.972695-05:00","closed_at":"2026-01-26T22:19:40.972695-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-r57","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T22:00:02.275194-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-r57","depends_on_id":"herdctl-d8f","type":"blocks","created_at":"2026-01-26T22:00:02.359561-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-t83","title":"Phase 4: Response Delivery","description":"Collect job output and deliver responses to Discord channels.\n\n## Files to Modify\n- packages/core/src/fleet-manager/discord-manager.ts\n\n## Implementation Details\n\n### Response Collection\nUsing the JobExecutor pattern from trigger.ts:\n```typescript\nconst response: string[] = [];\nawait this.context.jobExecutor.execute({\n  agent: agentConfig,\n  prompt: messageContent,\n  sessionId: session.id,\n  onMessage: (msg) =\u003e response.push(msg.content),\n});\nconst fullResponse = response.join('');\n```\n\n### Message Splitting\nDiscord has a 2000 character limit per message. Implement smart splitting:\n```typescript\nprivate splitResponse(text: string): string[] {\n  const MAX_LENGTH = 2000;\n  const chunks: string[] = [];\n  \n  // Split at natural boundaries (newlines, spaces)\n  // Preserve code blocks when possible\n  // Never split mid-word\n  \n  return chunks;\n}\n```\n\n### Code Block Preservation\nWhen splitting:\n1. Track if we're inside a code block (```...```)\n2. If split occurs inside code block, close it and reopen in next chunk\n3. Preserve language identifier (```typescript, ```json, etc.)\n\n### Error Response Format\nWhen execution fails:\n```typescript\nprivate formatErrorMessage(error: Error): string {\n  return `âŒ **Error**: ${error.message}\\n\\nPlease try again or use \\`/reset\\` to start a new session.`;\n}\n```\n\n## Acceptance Criteria\n- [ ] Full response collected via onMessage callback\n- [ ] Response split at 2000 char boundaries\n- [ ] Code blocks preserved when splitting\n- [ ] Splits occur at natural boundaries (newlines, spaces)\n- [ ] Error messages formatted user-friendly\n- [ ] Response sent to same channel as trigger message\n- [ ] pnpm typecheck passes\n- [ ] pnpm test passes\n- [ ] pnpm build succeeds","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-26T22:00:12.582942-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T22:22:46.817336-05:00","closed_at":"2026-01-26T22:22:46.817336-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-t83","depends_on_id":"herdctl-vxo","type":"parent-child","created_at":"2026-01-26T22:00:15.598476-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-t83","depends_on_id":"herdctl-r57","type":"blocks","created_at":"2026-01-26T22:00:15.681718-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t","title":"herdctl Documentation Site","description":"Build the documentation site for herdctl using Astro + Starlight in the docs/ directory. Provides comprehensive reference for all herdctl concepts, configuration system, and state management.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:04.301424-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:47:30.44622-05:00","closed_at":"2026-01-19T19:47:30.44622-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-prd-3-herdctl-documentation-site.md","labels":["feature","ralph"]}
{"id":"herdctl-u8t.1","title":"US-1: Initialize Astro with Starlight","description":"As a documentation contributor, I want to have a working Astro/Starlight project in docs/ so that I can create and preview documentation locally.\n\n## Acceptance Criteria\n- [ ] Astro 4.x with @astrojs/starlight installed in docs/\n- [ ] Package configured for pnpm workspace\n- [ ] pnpm dev starts local development server on port 4321\n- [ ] pnpm build produces static site in dist/\n- [ ] Site title: \"herdctl\"\n- [ ] Site tagline: \"Autonomous Agent Fleet Management for Claude Code\"\n- [ ] Configured for eventual deployment to herdctl.dev\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev starts correctly","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:10.677691-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:35:32.211952-05:00","closed_at":"2026-01-19T18:35:32.211952-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.1","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:10.678299-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.10","title":"US-10: Create Configuration Reference - Fleet Config","description":"As a fleet operator, I want to know all fleet configuration options so that I can configure my fleet correctly.\n\n## Acceptance Criteria\n- [ ] Documents herdctl.yaml complete schema\n- [ ] All fields documented with: Type (from Zod schema), Default value, Description, Example\n- [ ] Fields to document (from FleetConfigSchema):\n  - version: Config version (default: 1)\n  - fleet.name, fleet.description: Fleet metadata\n  - defaults: Default agent settings\n  - workspace.root, workspace.auto_clone, workspace.clone_depth, workspace.default_branch\n  - agents: Array of agent references\n  - chat.discord: Discord configuration\n  - webhooks: Webhook configuration\n  - docker: Docker configuration\n- [ ] Complete example YAML\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows fleet config page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:01.782423-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:02:41.155421-05:00","closed_at":"2026-01-19T19:02:41.155421-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.10","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:01.782996-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.10","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.115757-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.11","title":"US-11: Create Configuration Reference - Agent Config","description":"As a fleet operator, I want to know all agent configuration options so that I can configure my agents correctly.\n\n## Acceptance Criteria\n- [ ] Documents complete agent YAML schema\n- [ ] All fields documented (from AgentConfigSchema):\n  - name (required), description\n  - workspace, repo\n  - identity.name, identity.role, identity.personality\n  - system_prompt\n  - work_source.type, work_source.labels\n  - schedules (map of schedule configs)\n  - session.max_turns, session.timeout, session.model\n  - permissions (see Permissions page)\n  - mcp_servers (see MCP Servers page)\n  - chat.discord\n  - docker\n  - model, max_turns, permission_mode\n- [ ] Multiple examples: coder agent, marketer agent, support agent\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows agent config page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:08.380841-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:06:09.555395-05:00","closed_at":"2026-01-19T19:06:09.555395-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.11","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:08.381469-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.11","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.194838-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.12","title":"US-12: Create Configuration Reference - Permissions","description":"As a fleet operator, I want to control what tools my agents can use so that I can ensure appropriate access levels.\n\n## Acceptance Criteria\n- [ ] Documents permission modes (from PermissionModeSchema):\n  - default: Requires approval for everything\n  - acceptEdits: Auto-approve file operations\n  - bypassPermissions: Auto-approve everything\n  - plan: Planning only, no execution\n- [ ] Documents allowed_tools and denied_tools arrays\n- [ ] Documents bash restrictions: allowed_commands, denied_patterns\n- [ ] Examples for common permission patterns\n- [ ] Security recommendations\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows permissions page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:14.639194-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:08:47.715-05:00","closed_at":"2026-01-19T19:08:47.715-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.12","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:14.639758-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.12","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.278388-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.13","title":"US-13: Create Configuration Reference - MCP Servers","description":"As a fleet operator, I want to configure MCP servers for my agents so that agents can access external services.\n\n## Acceptance Criteria\n- [ ] Explains MCP concept briefly\n- [ ] Documents mcp_servers configuration (from McpServerSchema):\n  - HTTP-based: url\n  - Process-based: command, args, env\n- [ ] Documents tool naming: mcp__\u003cserver\u003e__\u003ctool\u003e\n- [ ] Documents wildcard support: mcp__posthog__*\n- [ ] Examples: PostHog, GitHub, filesystem MCP servers\n- [ ] Shows how to combine with allowed_tools\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows MCP servers page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:20.700839-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:11:50.324221-05:00","closed_at":"2026-01-19T19:11:50.324221-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.13","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:20.701414-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.13","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.359157-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.14","title":"US-14: Create Configuration Reference - Environment Variables","description":"As a fleet operator, I want to use environment variables in my config so that I can inject secrets safely.\n\n## Acceptance Criteria\n- [ ] Documents interpolation syntax:\n  - ${VAR_NAME}: Required variable\n  - ${VAR_NAME:-default}: With default value\n- [ ] Documents where interpolation works (any string value)\n- [ ] Documents error behavior for undefined variables\n- [ ] Security recommendations (never commit secrets)\n- [ ] Common patterns: API tokens, URLs, paths\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows environment page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:26.393124-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:14:54.297003-05:00","closed_at":"2026-01-19T19:14:54.297003-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.14","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:26.393675-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.14","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.438151-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.15","title":"US-15: Create State Management Reference","description":"As a developer or operator, I want to understand how herdctl stores state so that I can debug issues or integrate tooling.\n\n## Acceptance Criteria\n- [ ] Documents .herdctl/ directory structure:\n  - state.yaml: Fleet state\n  - jobs/: Job files\n  - sessions/: Session info\n  - logs/: Agent logs\n- [ ] Documents state.yaml format (from FleetStateSchema):\n  - fleet.started_at\n  - agents.\u003cname\u003e.status, current_job, last_job, next_schedule, etc.\n- [ ] Documents job file formats:\n  - job-\u003cid\u003e.yaml: Metadata\n  - job-\u003cid\u003e.jsonl: Streaming output\n- [ ] Documents JSONL message types from SPEC.md\n- [ ] Notes on atomic writes for safety\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows state management page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:33.630803-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:18:25.969837-05:00","closed_at":"2026-01-19T19:18:25.969837-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.15","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:33.631383-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.15","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.516783-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.16","title":"US-16: Create Getting Started Placeholder","description":"As a new user, I want to see a getting started guide so that I know how to begin using herdctl.\n\n## Acceptance Criteria\n- [ ] Placeholder page with clear \"Coming Soon\" message\n- [ ] Brief outline of what will be covered:\n  - Installation\n  - Creating your first agent\n  - Running your fleet\n  - Monitoring output\n- [ ] Links to Concepts section for background reading\n- [ ] Badge indicating placeholder status\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows getting started placeholder correctly","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:38.771524-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:20:07.309807-05:00","closed_at":"2026-01-19T19:20:07.309807-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.16","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:38.772063-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.16","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.597062-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.17","title":"US-17: Create CLI Reference Placeholder","description":"As a user, I want to see the CLI commands available so that I can operate my fleet.\n\n## Acceptance Criteria\n- [ ] Placeholder page with clear \"Coming Soon\" message\n- [ ] Lists planned commands from SPEC.md:\n  - herdctl start [agent]\n  - herdctl stop [agent]\n  - herdctl restart\n  - herdctl status [agent]\n  - herdctl logs [agent]\n  - herdctl trigger \u003cagent\u003e\n  - herdctl config validate\n  - herdctl web\n- [ ] Badge indicating placeholder status\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows CLI reference placeholder correctly","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:43.930838-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:22:07.360651-05:00","closed_at":"2026-01-19T19:22:07.360651-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.17","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:43.931389-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.17","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:06.674984-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.18","title":"US-18: Add Favicon and Assets","description":"As a site visitor, I want to see proper branding so that the site looks professional.\n\n## Acceptance Criteria\n- [ ] Favicon in docs/public/\n- [ ] Site logo configured (if available)\n- [ ] OpenGraph meta tags for social sharing\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows favicon correctly","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:31:48.292109-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T19:24:31.800702-05:00","closed_at":"2026-01-19T19:24:31.800702-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.18","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:31:48.294259-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.18","depends_on_id":"herdctl-u8t.1","type":"blocks","created_at":"2026-01-19T18:31:54.556219-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.2","title":"US-2: Create Landing Page and Structure","description":"As a visitor to the documentation, I want to see a welcoming overview page so that I understand what herdctl is and how to navigate the docs.\n\n## Acceptance Criteria\n- [ ] Welcome page (index.mdx) with project overview\n- [ ] Clear tagline: \"Autonomous Agent Fleet Management for Claude Code\"\n- [ ] Brief description of what herdctl does (from SPEC.md Vision section)\n- [ ] Quick navigation to key sections\n- [ ] Feature highlights (Fleet Management, Declarative Config, Multiple Triggers, Work Sources)\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows landing page correctly","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:16.460708-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:38:11.924009-05:00","closed_at":"2026-01-19T18:38:11.924009-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.2","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:16.461438-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.2","depends_on_id":"herdctl-u8t.1","type":"blocks","created_at":"2026-01-19T18:31:54.41114-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.3","title":"US-3: Configure Sidebar Navigation","description":"As a documentation reader, I want to navigate between sections easily so that I can find information quickly.\n\n## Acceptance Criteria\n- [ ] Starlight sidebar configured with hierarchical structure:\n  - Welcome\n  - Getting Started (placeholder)\n  - Concepts (Agents, Schedules, Triggers, Jobs, Workspaces, Sessions)\n  - Configuration (Fleet Config, Agent Config, Permissions, MCP Servers, Environment)\n  - Internals (State Management)\n  - CLI Reference (placeholder)\n- [ ] Sections collapsed by default for cleaner navigation\n- [ ] Badge for \"Placeholder\" sections\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows sidebar navigation correctly","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:21.452386-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:42:10.584377-05:00","closed_at":"2026-01-19T18:42:10.584377-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.3","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:21.452902-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.3","depends_on_id":"herdctl-u8t.1","type":"blocks","created_at":"2026-01-19T18:31:54.484122-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.4","title":"US-4: Create Concepts Section - Agents","description":"As a fleet operator, I want to understand what an Agent is so that I can configure my agents correctly.\n\n## Acceptance Criteria\n- [ ] Explains Agent concept (configured Claude instance with identity, workspace, permissions, schedules)\n- [ ] Includes ASCII diagram from SPEC.md showing Agent structure\n- [ ] Documents key agent properties: name, description, workspace, repo, identity, schedules\n- [ ] Links to Configuration Reference for detailed schema\n- [ ] Example agent YAML snippet\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows agents page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:27.610395-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:44:22.612255-05:00","closed_at":"2026-01-19T18:44:22.612255-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.4","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:27.610977-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.4","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:31:59.868314-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.5","title":"US-5: Create Concepts Section - Schedules","description":"As a fleet operator, I want to understand how Schedules work so that I can configure when my agents run.\n\n## Acceptance Criteria\n- [ ] Explains Schedule concept (trigger + prompt combination)\n- [ ] Documents that agents can have multiple schedules\n- [ ] Shows examples: hourly scan + daily analytics + weekly report\n- [ ] Links to Triggers concept\n- [ ] Example schedule YAML\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows schedules page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:33.158691-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:48:27.175655-05:00","closed_at":"2026-01-19T18:48:27.175655-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.5","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:33.159315-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.5","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:31:59.941105-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.6","title":"US-6: Create Concepts Section - Triggers","description":"As a fleet operator, I want to understand trigger types so that I can choose the right trigger for my use case.\n\n## Acceptance Criteria\n- [ ] Documents all trigger types:\n  - Interval: \"Every X minutes/hours after last completion\"\n  - Cron: Standard cron expressions\n  - Webhook: HTTP POST endpoints (future)\n  - Chat: Discord/Slack messages (future)\n- [ ] Shows syntax for each trigger type\n- [ ] Examples for common patterns\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows triggers page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:38.304936-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:51:27.1447-05:00","closed_at":"2026-01-19T18:51:27.1447-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.6","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:38.305451-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.6","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:00.018589-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.7","title":"US-7: Create Concepts Section - Jobs","description":"As a fleet operator, I want to understand what Jobs are so that I can track and monitor agent executions.\n\n## Acceptance Criteria\n- [ ] Explains Job concept (single execution of an agent)\n- [ ] Documents job properties: id, agent, schedule, status, session_id, timestamps, output\n- [ ] Documents job statuses: running, completed, failed, cancelled\n- [ ] Documents exit reasons: success, error, timeout, manual_cancel\n- [ ] Explains job output format (JSONL)\n- [ ] Links to State Management for storage details\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows jobs page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:44.297151-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:53:19.716924-05:00","closed_at":"2026-01-19T18:53:19.716924-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.7","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:44.297703-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.7","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:00.091165-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.8","title":"US-8: Create Concepts Section - Workspaces","description":"As a fleet operator, I want to understand workspace isolation so that my agents don't interfere with my development clones.\n\n## Acceptance Criteria\n- [ ] Explains workspace concept (directory where agent operates)\n- [ ] Documents the isolation problem (agents shouldn't touch dev clones)\n- [ ] Explains workspace root configuration\n- [ ] Shows directory structure example from SPEC.md\n- [ ] Documents auto-clone behavior\n- [ ] Notes that multiple agents can share a workspace\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows workspaces page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:49.751269-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:55:31.766505-05:00","closed_at":"2026-01-19T18:55:31.766505-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.8","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:49.751836-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.8","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:00.162027-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-u8t.9","title":"US-9: Create Concepts Section - Sessions","description":"As a fleet operator, I want to understand session management so that I can control agent context persistence.\n\n## Acceptance Criteria\n- [ ] Explains Session concept (Claude context)\n- [ ] Documents session modes:\n  - fresh_per_job: New session each job\n  - persistent: Maintain context across jobs\n  - per_channel: For chat integrations\n- [ ] Documents resume/fork capabilities\n- [ ] Example configuration\n- [ ] cd docs \u0026\u0026 pnpm build completes without errors\n- [ ] cd docs \u0026\u0026 pnpm dev shows sessions page correctly","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-19T18:30:54.695893-05:00","created_by":"Ed Spencer","updated_at":"2026-01-19T18:57:56.37347-05:00","closed_at":"2026-01-19T18:57:56.37347-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-u8t.9","depends_on_id":"herdctl-u8t","type":"parent-child","created_at":"2026-01-19T18:30:54.696431-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-u8t.9","depends_on_id":"herdctl-u8t.3","type":"blocks","created_at":"2026-01-19T18:32:00.233926-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-vxo","title":"Discord Chat Integration - FleetManager Bridge","description":"Enable interactive chat with Claude agents through Discord by integrating the existing @herdctl/discord package with FleetManager. \n\n## Problem\nThe @herdctl/discord package (v0.0.2) exists and can connect to Discord, receive messages, and emit events. However, there's no integration with FleetManager:\n- Discord bots don't start when running `herdctl start`\n- Incoming messages don't trigger agent execution\n- There's no pipeline to deliver Claude responses back to Discord\n\n## Success Criteria\n1. Running `herdctl start` with Discord-configured agents automatically starts their Discord bots\n2. Users can @mention a bot or use auto-mode to trigger Claude execution\n3. Claude responses are delivered to the Discord channel\n4. Session history persists across bot restarts (per-channel context)\n5. Multiple agents can have independent Discord configurations\n6. Unit tests achieve 85% line coverage\n\n## Architecture\nCreates a new DiscordManager module in @herdctl/core that:\n- Manages lifecycle of DiscordConnector instances (one per Discord-configured agent)\n- Subscribes to connector events (message, mention, error)\n- Routes messages to job execution via JobExecutor\n- Handles response delivery back to Discord\n\n## Packages Modified\n- @herdctl/core (minor) - New DiscordManager module\n- @herdctl/discord (patch) - Any connector fixes found during integration","status":"open","priority":1,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-26T21:59:22.116387-05:00","created_by":"Ed Spencer","updated_at":"2026-01-26T21:59:22.116387-05:00","external_ref":"prd:./tasks/discord-chat-integration/SPEC.md","labels":["feature","ralph"]}
{"id":"herdctl-wck","title":"FleetManager - Orchestration Layer","description":"Central orchestration class that wires all existing modules (Config, State, Runner, Work Sources, Scheduler) together and provides a clean, event-driven API for fleet management. Enables interaction layers (CLI, Web UI, HTTP API) to be thin wrappers with no business logic.","status":"closed","priority":2,"issue_type":"epic","owner":"ed@edspencer.net","created_at":"2026-01-20T08:10:39.240213-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T15:07:23.59238-05:00","closed_at":"2026-01-20T15:07:23.59238-05:00","close_reason":"Closed","external_ref":"prd:./tasks/prd-prd-7-fleetmanager-orchestration-layer.md","labels":["feature","ralph"]}
{"id":"herdctl-wck.1","title":"US-1: Library Consumer Initialization","description":"As a developer using @herdctl/core as a library, I want to initialize and start a fleet manager with minimal configuration so that I can manage agent fleets without understanding internal module wiring.\n\n## Acceptance Criteria\n- [ ] Can construct FleetManager with just `configPath` and `stateDir`\n- [ ] `initialize()` loads config, validates it, and prepares state directory\n- [ ] `start()` begins scheduler and processes schedules\n- [ ] Clear error messages if config is invalid or paths don't exist\n- [ ] All options have sensible defaults\n- [ ] Create FleetManagerOptions interface\n- [ ] Create FleetManager class extending EventEmitter with state property\n- [ ] Implement file structure: fleet-manager/, types.ts, fleet-manager.ts, errors.ts, index.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:10:46.544503-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:16:24.123906-05:00","closed_at":"2026-01-20T08:16:24.123906-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.1","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:10:46.545137-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.10","title":"US-10: Concurrency Control","description":"As a system administrator, I want to control how many jobs run concurrently so that I don't overwhelm system resources.\n\n## Acceptance Criteria\n- [ ] Per-agent concurrency limit (configurable, default: 1)\n- [ ] Fleet-wide concurrency limit (optional cap across all agents)\n- [ ] Jobs queue when limits are reached\n- [ ] Queue is FIFO within priority levels\n- [ ] Can query queue status\n- [ ] Concurrency limits configurable at construction and via config\n- [ ] Create job-queue.ts with concurrency control logic\n- [ ] When schedule triggers at concurrency limit: emit `schedule:skipped` with reason, don't queue scheduled triggers\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:38.570089-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:01:47.334228-05:00","closed_at":"2026-01-20T09:01:47.334228-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.10","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:38.570819-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.10","depends_on_id":"herdctl-wck.5","type":"blocks","created_at":"2026-01-20T08:12:10.912899-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.11","title":"US-11: Log Streaming","description":"As a developer monitoring fleet activity, I want to stream logs from the fleet and specific jobs so that I can observe activity in real-time.\n\n## Acceptance Criteria\n- [ ] `streamLogs(options?)` streams all fleet logs\n- [ ] `streamJobOutput(jobId)` streams specific job output\n- [ ] `streamAgentLogs(agentName)` streams logs for specific agent\n- [ ] Streams are async iterables\n- [ ] Can specify log level filter\n- [ ] Works with running and completed jobs (replays history for completed)\n- [ ] Create LogStreamOptions, LogEntry interfaces in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:44.426585-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:05:11.031054-05:00","closed_at":"2026-01-20T09:05:11.031054-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.11","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:44.427211-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.11","depends_on_id":"herdctl-wck.4","type":"blocks","created_at":"2026-01-20T08:12:10.993381-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.12","title":"US-12: Error Handling","description":"As a library consumer, I want clear, typed errors for all failure modes so that I can handle errors appropriately in my application.\n\n## Acceptance Criteria\n- [ ] All errors extend FleetManagerError base class\n- [ ] Implement ConfigurationError with code, configPath, validationErrors\n- [ ] Implement AgentNotFoundError with code, agentName\n- [ ] Implement JobNotFoundError with code, jobId\n- [ ] Implement ScheduleNotFoundError with code, agentName, scheduleName\n- [ ] Implement InvalidStateError with code, currentState, expectedState, operation\n- [ ] Implement ConcurrencyLimitError with code, agentName, currentJobs, limit\n- [ ] Errors include relevant context (agent name, job id, etc.)\n- [ ] Errors are typed for TypeScript consumers\n- [ ] Error messages are actionable\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:51.845581-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:24:12.429256-05:00","closed_at":"2026-01-20T08:24:12.429256-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.12","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:51.84631-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.12","depends_on_id":"herdctl-wck.1","type":"blocks","created_at":"2026-01-20T08:12:10.096434-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.13","title":"US-13: Integration Tests and Export","description":"Final integration tests and public export setup for FleetManager.\n\n## Acceptance Criteria\n- [ ] Full flow integration test: initialize â†’ start â†’ trigger â†’ complete â†’ stop\n- [ ] Scheduler integration test: schedules trigger jobs correctly\n- [ ] State persistence test: survives restart with correct state\n- [ ] Edge case tests: start when running, stop when stopped, trigger non-existent agent, etc.\n- [ ] Update packages/core/src/index.ts to export FleetManager and all types\n- [ ] \u003e90% test coverage on fleet-manager module\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes\n- [ ] pnpm test passes","status":"closed","priority":3,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:58.471743-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T09:12:43.233789-05:00","closed_at":"2026-01-20T09:12:43.233789-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.13","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:58.472385-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.13","depends_on_id":"herdctl-wck.8","type":"blocks","created_at":"2026-01-20T08:12:11.072546-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.13","depends_on_id":"herdctl-wck.9","type":"blocks","created_at":"2026-01-20T08:12:11.151798-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.13","depends_on_id":"herdctl-wck.10","type":"blocks","created_at":"2026-01-20T08:12:11.233049-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.13","depends_on_id":"herdctl-wck.11","type":"blocks","created_at":"2026-01-20T08:12:11.312278-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.2","title":"US-2: Real-time Event Subscription","description":"As a developer building a UI for herdctl, I want to subscribe to fleet events in real-time so that I can update my UI as jobs start, complete, and produce output.\n\n## Acceptance Criteria\n- [ ] FleetManager extends EventEmitter (already done in US-1)\n- [ ] Create event-types.ts with typed event definitions\n- [ ] Emits typed events for all state changes\n- [ ] Events: started, stopped, config:reloaded, agent:started, agent:stopped\n- [ ] Events: schedule:triggered, schedule:skipped, job:created, job:output, job:completed, job:failed\n- [ ] Events include relevant payload data\n- [ ] Can subscribe/unsubscribe at any time\n- [ ] Events are emitted synchronously (non-blocking)\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":1,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:10:53.034537-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:21:20.00694-05:00","closed_at":"2026-01-20T08:21:20.00694-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.2","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:10:53.035139-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.2","depends_on_id":"herdctl-wck.1","type":"blocks","created_at":"2026-01-20T08:12:10.176971-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.3","title":"US-3: Fleet Status Queries","description":"As a CLI user running `herdctl status`, I want to query the current fleet status so that I can see what agents are configured and what jobs are running.\n\n## Acceptance Criteria\n- [ ] `getStatus()` returns overall fleet status (state, uptime, agents counts, jobs counts, scheduler info)\n- [ ] `getAgents()` returns all configured agents with current state\n- [ ] `getAgent(name)` returns specific agent details\n- [ ] Query methods work whether fleet is running or stopped\n- [ ] Returns consistent snapshot (no partial reads)\n- [ ] Create FleetStatus, AgentInfo interfaces in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:10:58.507598-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:28:49.612918-05:00","closed_at":"2026-01-20T08:28:49.612918-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.3","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:10:58.508163-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.3","depends_on_id":"herdctl-wck.2","type":"blocks","created_at":"2026-01-20T08:12:10.255197-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.3","depends_on_id":"herdctl-wck.12","type":"blocks","created_at":"2026-01-20T08:12:10.337553-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.4","title":"US-4: Job Management","description":"As a developer debugging an agent, I want to query job history and stream job output so that I can understand what the agent did and troubleshoot issues.\n\n## Acceptance Criteria\n- [ ] `getJobs(filter?)` returns jobs with optional filtering by agent, status, time range\n- [ ] `getJob(id)` returns specific job details including output\n- [ ] Job history is persisted and survives restarts\n- [ ] Keeps last N jobs per agent (configurable, default: 100)\n- [ ] Optional fleet-wide job limit cap\n- [ ] Can stream output from running jobs in real-time\n- [ ] Create Job, JobFilter interfaces in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:04.397864-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:36:30.118486-05:00","closed_at":"2026-01-20T08:36:30.118486-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.4","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:04.398468-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.4","depends_on_id":"herdctl-wck.3","type":"blocks","created_at":"2026-01-20T08:12:10.419-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.5","title":"US-5: Manual Agent Triggering","description":"As an operator, I want to manually trigger an agent outside its schedule so that I can test agents or handle urgent situations.\n\n## Acceptance Criteria\n- [ ] `trigger(agentName, scheduleName?, options?)` creates and starts a job\n- [ ] Can trigger specific schedule or use agent defaults\n- [ ] Can pass runtime options (work items, prompt overrides)\n- [ ] Returns the created job\n- [ ] Respects concurrency limits\n- [ ] Create TriggerOptions interface in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:10.285095-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:40:34.356409-05:00","closed_at":"2026-01-20T08:40:34.356409-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.5","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:10.285699-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.5","depends_on_id":"herdctl-wck.4","type":"blocks","created_at":"2026-01-20T08:12:10.497902-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.6","title":"US-6: Job Control","description":"As an operator, I want to cancel running jobs and fork existing jobs so that I can manage runaway jobs and re-run jobs with modifications.\n\n## Acceptance Criteria\n- [ ] `cancelJob(jobId)` cancels a running job gracefully\n- [ ] `forkJob(jobId, modifications?)` creates new job based on existing one\n- [ ] Cancel sends SIGTERM, waits for graceful shutdown, then SIGKILL\n- [ ] Fork copies job config and optionally applies modifications\n- [ ] Both operations emit appropriate events\n- [ ] Create JobModifications interface in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:15.683009-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:45:26.255943-05:00","closed_at":"2026-01-20T08:45:26.255943-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.6","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:15.683611-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.6","depends_on_id":"herdctl-wck.5","type":"blocks","created_at":"2026-01-20T08:12:10.579267-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.7","title":"US-7: Schedule Management","description":"As an operator, I want to view and control schedules at runtime so that I can temporarily disable schedules without editing config files.\n\n## Acceptance Criteria\n- [ ] `getSchedules()` returns all schedules with next trigger times\n- [ ] `getSchedule(agentName, scheduleName)` returns specific schedule\n- [ ] `enableSchedule(agentName, scheduleName)` enables a disabled schedule\n- [ ] `disableSchedule(agentName, scheduleName)` disables a schedule\n- [ ] Disabled state persists across restarts (stored in state)\n- [ ] Disabled schedules don't trigger but remain in config\n- [ ] Create ScheduleInfo interface in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:21.06623-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:48:24.544626-05:00","closed_at":"2026-01-20T08:48:24.544626-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.7","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:21.066889-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.7","depends_on_id":"herdctl-wck.3","type":"blocks","created_at":"2026-01-20T08:12:10.659686-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.8","title":"US-8: Graceful Shutdown","description":"As a system administrator, I want to shut down the fleet gracefully so that running jobs complete properly and state is preserved.\n\n## Acceptance Criteria\n- [ ] `stop(options?)` initiates graceful shutdown\n- [ ] Can wait for running jobs to complete\n- [ ] Can specify timeout for job completion\n- [ ] After timeout, jobs are cancelled\n- [ ] All state is persisted before shutdown completes\n- [ ] Emits `stopped` event when complete\n- [ ] Create StopOptions interface in types.ts\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:27.089911-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:52:01.668969-05:00","closed_at":"2026-01-20T08:52:01.668969-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.8","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:27.090458-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.8","depends_on_id":"herdctl-wck.6","type":"blocks","created_at":"2026-01-20T08:12:10.744245-05:00","created_by":"Ed Spencer"}]}
{"id":"herdctl-wck.9","title":"US-9: Hot Configuration Reload","description":"As an operator, I want to reload configuration without restarting the fleet so that I can update agent definitions without downtime.\n\n## Acceptance Criteria\n- [ ] `reload()` reloads and validates configuration\n- [ ] Running jobs continue with their original config\n- [ ] New jobs use the new configuration\n- [ ] Scheduler updates to reflect new schedules\n- [ ] Emits `config:reloaded` event with list of changes\n- [ ] Fails gracefully if new config is invalid (keeps old config)\n- [ ] pnpm typecheck passes\n- [ ] pnpm lint passes","status":"closed","priority":2,"issue_type":"task","owner":"ed@edspencer.net","created_at":"2026-01-20T08:11:32.19185-05:00","created_by":"Ed Spencer","updated_at":"2026-01-20T08:57:14.855235-05:00","closed_at":"2026-01-20T08:57:14.855235-05:00","close_reason":"Completed by agent","labels":["ralph","task"],"dependencies":[{"issue_id":"herdctl-wck.9","depends_on_id":"herdctl-wck","type":"parent-child","created_at":"2026-01-20T08:11:32.192542-05:00","created_by":"Ed Spencer"},{"issue_id":"herdctl-wck.9","depends_on_id":"herdctl-wck.7","type":"blocks","created_at":"2026-01-20T08:12:10.832332-05:00","created_by":"Ed Spencer"}]}
