# herdctl Security Scanner Fleet Configuration
#
# This configuration runs a daily security audit of the herdctl codebase
# using herdctl itself (dogfooding).
#
# To run manually:
#   herdctl run --config .security/fleet.yaml security-auditor
#
# To start the scheduled fleet:
#   herdctl start --config .security/fleet.yaml

name: herdctl-security-scanner

defaults:
  # Accept edits mode - the security agent needs to write reports and commit
  permission_mode: acceptEdits

  # Model selection - use a capable model for security analysis
  model: claude-sonnet-4-20250514

agents:
  security-auditor:
    description: Daily security audit of herdctl codebase

    prompt: |
      You are running a scheduled security audit for the herdctl project - a TypeScript
      system for managing fleets of Claude Code agents.

      Run the daily security audit by invoking:

      /security-audit-daily

      This will:
      - Switch to the security-audits branch
      - Run the full security scanner
      - Analyze recent commits for security impact
      - Verify critical hot spots
      - Investigate open security questions
      - Generate intelligence and review reports
      - Create an executive summary with GREEN/YELLOW/RED status
      - Commit and push all artifacts
      - Return to the original branch

      The skill handles all orchestration automatically. Just invoke it and report
      the final status when complete.

    workspace: .

    schedule:
      # Run daily at 6am UTC
      cron: "0 6 * * *"

    # Environment variables needed
    env:
      # Inherit from parent environment
      NODE_ENV: production
