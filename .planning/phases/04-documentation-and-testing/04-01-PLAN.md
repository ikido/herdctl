---
phase: 04-documentation-and-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/src/content/docs/configuration/runtime.md
  - docs/src/content/docs/configuration/docker.md
  - docs/src/content/docs/configuration/agent-config.md
autonomous: true

must_haves:
  truths:
    - "Documentation explains when to use SDK vs CLI runtime with decision matrix"
    - "Docker security model documented with isolation guarantees"
    - "Configuration reference includes all runtime and docker fields"
  artifacts:
    - path: "docs/src/content/docs/configuration/runtime.md"
      provides: "Runtime selection documentation"
      min_lines: 100
    - path: "docs/src/content/docs/configuration/docker.md"
      provides: "Docker configuration and security documentation"
      min_lines: 150
  key_links:
    - from: "docs/src/content/docs/configuration/agent-config.md"
      to: "docs/src/content/docs/configuration/runtime.md"
      via: "cross-reference link"
      pattern: "/configuration/runtime/"
    - from: "docs/src/content/docs/configuration/agent-config.md"
      to: "docs/src/content/docs/configuration/docker.md"
      via: "cross-reference link"
      pattern: "/configuration/docker/"
---

<objective>
Create comprehensive documentation for runtime selection and Docker containerization

Purpose: Enable users to understand when to use SDK vs CLI runtime and how to configure Docker for security isolation
Output: Two new documentation pages (runtime.md, docker.md) and updated agent-config.md cross-references
</objective>

<execution_context>
@/Users/ed/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ed/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-documentation-and-testing/04-CONTEXT.md

# Source files to document
@packages/core/src/runner/runtime/factory.ts
@packages/core/src/runner/runtime/docker-config.ts
@packages/core/src/config/schema.ts

# Existing docs for style reference
@docs/src/content/docs/configuration/agent-config.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Runtime Configuration Documentation</name>
  <files>docs/src/content/docs/configuration/runtime.md</files>
  <action>
Create comprehensive runtime documentation at `docs/src/content/docs/configuration/runtime.md`.

Include:
1. **Overview section** explaining SDK vs CLI runtimes:
   - SDK runtime: Uses Claude Agent SDK directly (standard pricing)
   - CLI runtime: Spawns `claude` CLI command (Max plan pricing)

2. **Decision matrix table** showing when to use each:
   | Factor | SDK Runtime | CLI Runtime |
   |--------|-------------|-------------|
   | Pricing | Standard API | Max plan (if subscribed) |
   | Setup | Just API key | Claude CLI installed + logged in |
   | Features | Full SDK support | Full Claude Code capabilities |
   | Best for | API-only deployments | Max plan users wanting cost savings |

3. **Configuration section** with examples:
   ```yaml
   # SDK runtime (default)
   name: my-agent
   runtime: sdk  # or omit (sdk is default)

   # CLI runtime
   name: cli-agent
   runtime: cli
   ```

4. **CLI Requirements section**:
   - Claude CLI must be installed (`npm install -g @anthropic-ai/claude-code`)
   - User must be logged in (`claude login`)
   - Session files are managed by Claude CLI in `~/.claude/`

5. **Session Management section** explaining:
   - SDK sessions stored in `.herdctl/sessions/`
   - CLI sessions managed by Claude CLI (separate from herdctl)
   - No session migration between runtime types

Use Starlight frontmatter format:
```
---
title: Runtime Configuration
description: Choose between SDK and CLI runtimes for agent execution
---
```
  </action>
  <verify>File exists at docs/src/content/docs/configuration/runtime.md with decision matrix table and code examples</verify>
  <done>Runtime documentation page created with clear decision guidance and configuration examples</done>
</task>

<task type="auto">
  <name>Task 2: Create Docker Configuration Documentation</name>
  <files>docs/src/content/docs/configuration/docker.md</files>
  <action>
Create comprehensive Docker documentation at `docs/src/content/docs/configuration/docker.md`.

Include:
1. **Overview section** explaining Docker containerization benefits:
   - Security isolation for untrusted prompts
   - Resource limits (memory, CPU)
   - Network isolation options
   - Clean environment per job

2. **Security Model section** documenting guarantees:
   - Containers run as non-root user (matches host UID:GID by default)
   - `--security-opt no-new-privileges` prevents privilege escalation
   - `--cap-drop=ALL` removes all Linux capabilities
   - Auth files mounted read-only
   - Workspace mounted read-write (configurable)
   - Optional network isolation (none/bridge/host)

3. **Configuration Reference** with all DockerSchema fields:
   ```yaml
   docker:
     enabled: true
     image: "anthropic/claude-code:latest"  # Default
     network: "bridge"  # none | bridge | host
     memory: "2g"       # Memory limit
     cpu_shares: 1024   # CPU relative weight (optional)
     user: "1000:1000"  # UID:GID (defaults to host user)
     workspace_mode: "rw"  # rw | ro
     volumes:
       - "/host/path:/container/path:ro"
     ephemeral: false   # Fresh container per job
     max_containers: 5  # Container pool limit
   ```

4. **Network Modes section**:
   | Mode | Description | Use Case |
   |------|-------------|----------|
   | `bridge` | Full network (default) | Agents needing internet/APIs |
   | `host` | Share host network | Performance-critical, trusted |
   | `none` | No network | Maximum isolation |

5. **Volume Mounts section** with examples:
   - Workspace is auto-mounted
   - Auth files auto-mounted read-only at `~/.claude/`
   - Additional volumes via `volumes` array

6. **Path Translation section** explaining:
   - Host paths translated to container paths automatically
   - Docker sessions stored in `.herdctl/docker-sessions/` (not `.herdctl/sessions/`)
   - Prevents path conflicts between Docker and host execution

7. **Resource Limits section**:
   - Memory format: "512m", "2g", "4096" (bytes)
   - CPU shares: relative weight (default: no limit)

Use Starlight frontmatter:
```
---
title: Docker Configuration
description: Run agents in isolated Docker containers for security
---
```
  </action>
  <verify>File exists at docs/src/content/docs/configuration/docker.md with security model, configuration reference, and network modes table</verify>
  <done>Docker documentation page created with comprehensive security model and configuration examples</done>
</task>

<task type="auto">
  <name>Task 3: Update Agent Config Documentation with Cross-References</name>
  <files>docs/src/content/docs/configuration/agent-config.md</files>
  <action>
Update the existing agent-config.md to include proper cross-references and expand the runtime/docker sections.

1. **Add runtime field to Top-Level Fields table** (after line ~87):
   | `runtime` | string | No | Runtime type: `"sdk"` (default) or `"cli"` |

2. **Add new section "### runtime"** (after the model section, around line 610):
   ```markdown
   ### runtime

   Select the runtime backend for this agent.

   ```yaml
   runtime: cli  # Use CLI runtime (Max plan pricing)
   ```

   | Value | Description |
   |-------|-------------|
   | `sdk` | Claude Agent SDK (default, standard pricing) |
   | `cli` | Claude CLI (Max plan pricing, requires CLI installed) |

   See [Runtime Configuration](/configuration/runtime/) for detailed guidance on choosing a runtime.
   ```

3. **Expand the docker section** (around line 592-605) to include more fields:
   ```markdown
   ### docker

   Run the agent in a Docker container for security isolation.

   ```yaml
   docker:
     enabled: true
     image: "anthropic/claude-code:latest"
     network: bridge
     memory: "2g"
     user: "1000:1000"
     workspace_mode: rw
     volumes:
       - "/data/models:/models:ro"
   ```

   | Field | Type | Default | Description |
   |-------|------|---------|-------------|
   | `enabled` | boolean | `false` | Enable Docker execution |
   | `image` | string | `anthropic/claude-code:latest` | Docker image |
   | `network` | string | `bridge` | Network mode: `none`, `bridge`, `host` |
   | `memory` | string | `2g` | Memory limit |
   | `cpu_shares` | integer | â€” | CPU relative weight |
   | `user` | string | Host UID:GID | Container user |
   | `workspace_mode` | string | `rw` | Workspace mount: `rw` or `ro` |
   | `volumes` | array | `[]` | Additional volume mounts |
   | `ephemeral` | boolean | `false` | Fresh container per job |
   | `max_containers` | integer | `5` | Container pool limit |

   See [Docker Configuration](/configuration/docker/) for security model and detailed options.
   ```

4. **Add Related Pages entries** at the end of the file:
   - [Runtime Configuration](/configuration/runtime/) - SDK vs CLI runtime selection
   - [Docker Configuration](/configuration/docker/) - Container security and isolation
  </action>
  <verify>grep -q "/configuration/runtime/" docs/src/content/docs/configuration/agent-config.md && grep -q "/configuration/docker/" docs/src/content/docs/configuration/agent-config.md</verify>
  <done>Agent config documentation updated with runtime field, expanded docker section, and cross-references</done>
</task>

</tasks>

<verification>
1. New files exist:
   - docs/src/content/docs/configuration/runtime.md
   - docs/src/content/docs/configuration/docker.md

2. Cross-references work:
   - agent-config.md links to runtime.md
   - agent-config.md links to docker.md

3. Documentation completeness:
   - Runtime page has decision matrix
   - Docker page has security model
   - All DockerSchema fields documented
</verification>

<success_criteria>
- Runtime documentation explains SDK vs CLI with clear decision matrix
- Docker documentation covers security model, network modes, volume mounts
- Agent config has runtime field documented and expanded docker section
- Cross-references link all related pages
</success_criteria>

<output>
After completion, create `.planning/phases/04-documentation-and-testing/04-01-SUMMARY.md`
</output>
